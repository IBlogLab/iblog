{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"aac7c5c0-55a3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T00:01:44.520Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cb1ce710-55a3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.91.0.71","x-forwarded-proto":"https","x-real-ip":"3.91.0.71","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"70ms"},"msg":"","time":"2019-04-03T00:02:38.792Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d01702f0-55a3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.82.50.90","x-forwarded-proto":"https","x-real-ip":"3.82.50.90","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T00:02:47.118Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6a266750-55a4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.82.50.90","x-forwarded-proto":"https","x-real-ip":"3.82.50.90","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T00:07:05.606Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8349a530-55a4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.242.246","x-forwarded-proto":"https","x-real-ip":"35.173.242.246","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T00:07:47.761Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9dee7a00-55a4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T00:08:32.468Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b6b67880-55a4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/","params":{},"headers":{"x-forwarded-for":"207.46.13.155","x-forwarded-proto":"https","x-real-ip":"207.46.13.155","host":"www.lancexlab.cn","connection":"close","cache-control":"no-cache","pragma":"no-cache","accept":"*/*","accept-encoding":"gzip, deflate","from":"bingbot(at)microsoft.com","user-agent":"Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"7fb2-6Aq0/cYP1s9GcA3VvbGTO4qr8t4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"222ms"},"msg":"","time":"2019-04-03T00:09:14.217Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cb84b420-55a4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/robots.txt","method":"GET","originalUrl":"/robots.txt","params":{},"headers":{"x-forwarded-for":"203.208.60.58","x-forwarded-proto":"https","x-real-ip":"203.208.60.58","host":"lancexlab.cn","connection":"close","accept":"text/plain,text/html,*/*","user-agent":"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)","accept-encoding":"gzip,deflate,br"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"text/plain","content-length":88,"etag":"\"f15f756fcf0b8854e4d47b134faf739c\"","cache-control":"public, max-age=3600","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T00:09:48.901Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cbf74c10-55a4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/sitemap-authors.xml","method":"GET","originalUrl":"/sitemap-authors.xml","params":{"resource":"authors"},"headers":{"x-forwarded-for":"203.208.60.53","x-forwarded-proto":"https","x-real-ip":"203.208.60.53","host":"lancexlab.cn","connection":"close","accept":"*/*","from":"googlebot(at)googlebot.com","user-agent":"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)","accept-encoding":"gzip,deflate,br"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=3600","content-type":"text/xml; charset=utf-8","content-length":"780","etag":"W/\"30c-tAPQ+/OIXH3iQhparV4F0tptmIs\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T00:09:49.652Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e5384b20-55a4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","params":{},"headers":{"x-forwarded-for":"10.108.121.1, 36.74.100.35","x-forwarded-proto":"http","x-real-ip":"36.74.100.35","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","accept-language":"en-US,en;q=0.5","accept-encoding":"gzip, deflate","dnt":"1","referer":"http://lancexlab.cn/","origin":"http://lancexlab.cn","x-proxy-id":"734470881","via":"1.1 10.108.121.2 (Mikrotik HttpProxy)"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=31536000","location":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","vary":"Accept, Accept-Encoding","content-type":"text/html; charset=utf-8","content-length":"176"},"statusCode":301,"responseTime":"1ms"},"msg":"","time":"2019-04-03T00:10:32.020Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e5ca03d0-55a4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","params":{},"headers":{"x-forwarded-for":"10.108.121.1, 36.74.100.35","x-forwarded-proto":"http","x-real-ip":"36.74.100.35","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","accept-language":"en-US,en;q=0.5","accept-encoding":"gzip, deflate","dnt":"1","x-proxy-id":"734470881","via":"1.1 10.108.121.2 (Mikrotik HttpProxy)"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=31536000","location":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","vary":"Accept, Accept-Encoding","content-type":"text/html; charset=utf-8","content-length":"176"},"statusCode":301,"responseTime":"1ms"},"msg":"","time":"2019-04-03T00:10:32.977Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2d2699a0-55a5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.82.50.90","x-forwarded-proto":"https","x-real-ip":"3.82.50.90","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"82ms"},"msg":"","time":"2019-04-03T00:12:32.781Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4389f430-55a5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T00:13:10.315Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"69f54fc0-55a5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.82.50.90","x-forwarded-proto":"https","x-real-ip":"3.82.50.90","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T00:14:14.763Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c4e7a130-55a5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T00:16:47.346Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ea76a680-55a5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.82.50.90","x-forwarded-proto":"https","x-real-ip":"3.82.50.90","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T00:17:50.375Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"180147e0-55a6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"65ms"},"msg":"","time":"2019-04-03T00:19:06.789Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5ccde400-55a6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"83ms"},"msg":"","time":"2019-04-03T00:21:02.229Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a203f050-55a6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T00:22:58.310Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"be830360-55a6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T00:23:46.130Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"022d66a0-55a7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T00:25:39.644Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4954bba0-55a7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.107.83","x-forwarded-proto":"https","x-real-ip":"54.198.107.83","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T00:27:39.018Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7abfa470-55a7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"81ms"},"msg":"","time":"2019-04-03T00:29:01.961Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ab902200-55a7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"40ms"},"msg":"","time":"2019-04-03T00:30:23.817Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"eb4f8f70-55a7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T00:32:10.787Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1d16f020-55a8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"151ms"},"msg":"","time":"2019-04-03T00:33:34.396Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"71780af0-55a8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T00:35:55.860Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"93f16bd0-55a8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T00:36:53.688Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cb6a2a70-55a8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T00:38:26.762Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0b64f330-55a9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T00:40:14.093Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4ff63400-55a9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T00:42:09.136Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7cc52680-55a9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"70ms"},"msg":"","time":"2019-04-03T00:43:24.336Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b7076560-55a9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"66ms"},"msg":"","time":"2019-04-03T00:45:02.074Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ed90e200-55a9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T00:46:33.566Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"35eda9c0-55aa-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"38ms"},"msg":"","time":"2019-04-03T00:48:34.947Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"83cd4560-55aa-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T00:50:45.607Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9d9527b0-55aa-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T00:51:28.862Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"dd901780-55aa-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T00:53:16.199Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4702df90-55ab-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T00:56:13.114Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4b284650-55ab-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T00:56:20.076Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"78f288c0-55ab-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T00:57:36.892Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e67a15c0-55ab-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"144ms"},"msg":"","time":"2019-04-03T01:00:40.750Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"04d3b530-55ac-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T01:01:31.571Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3fbc1f20-55ac-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T01:03:10.403Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9d3b8410-55ac-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T01:05:47.276Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d123a1e0-55ac-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T01:07:14.361Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"04b0a760-55ad-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T01:08:40.839Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4806f730-55ad-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T01:10:33.819Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"878b0950-55ad-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"60ms"},"msg":"","time":"2019-04-03T01:12:20.386Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b48132e0-55ad-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T01:13:35.822Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"10ccabb0-55ae-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T01:16:10.658Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"355f9dc0-55ae-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"67ms"},"msg":"","time":"2019-04-03T01:17:12.034Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7325fa50-55ae-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"40ms"},"msg":"","time":"2019-04-03T01:18:55.647Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b28f0a60-55ae-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.146.33","x-forwarded-proto":"https","x-real-ip":"35.171.146.33","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T01:20:42.036Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f3f486b0-55ae-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T01:22:31.763Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1e50a470-55af-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"83ms"},"msg":"","time":"2019-04-03T01:23:42.859Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7beb5990-55af-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"124ms"},"msg":"","time":"2019-04-03T01:26:19.946Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a1a28050-55af-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T01:27:23.162Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d45d41b0-55af-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"92ms"},"msg":"","time":"2019-04-03T01:28:48.296Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"19b44380-55b0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T01:30:44.600Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5263fb80-55b0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T01:32:19.693Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8ad746c0-55b0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T01:33:54.397Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c4c28c00-55b0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.88.162.238","x-forwarded-proto":"https","x-real-ip":"3.88.162.238","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T01:35:31.572Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f3849bf0-55b0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T01:36:50.020Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2d2f2eb0-55b1-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","params":{"slug":"spring-cloud-gatewayzhi-jia-gou-she-ji"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"9912-I/TS1GLvOP5GRJJMzHc3DSocVn8\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","etag":"W/\"9912-I/TS1GLvOP5GRJJMzHc3DSocVn8\""},"statusCode":304,"responseTime":"118ms"},"msg":"","time":"2019-04-03T01:38:26.834Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2d650bc0-55b1-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"79ms"},"msg":"","time":"2019-04-03T01:38:27.148Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3ecdae30-55b1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"70ms"},"msg":"","time":"2019-04-03T01:38:56.346Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5c036710-55b1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T01:39:45.333Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8cc16e10-55b1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T01:41:07.103Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f5b39470-55b1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"62ms"},"msg":"","time":"2019-04-03T01:44:03.190Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0487d060-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"140ms"},"msg":"","time":"2019-04-03T01:44:28.150Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"35fc0800-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"20f6e-lCdyEwLMLvWOFFzhojj6J7oT8L0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"82ms"},"msg":"","time":"2019-04-03T01:45:51.059Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"52f04b10-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"2469","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-02T11:32:55.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-02T10:46:56.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-02T11:23:12.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"fae-7qvcx5FWeaALlCqTVOrMRsnecJs\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"195ms"},"msg":"","time":"2019-04-03T01:46:39.751Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"999d6700-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21031-LUYXDBNegAL4KXp/q60siXKO+Gk\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T01:48:38.187Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ae217a40-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21031-LUYXDBNegAL4KXp/q60siXKO+Gk\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T01:49:12.595Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c898fd80-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"2822","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:46:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"110f-ZaxN7TZdbrtsvMYEL1Qjqjr5bW0\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"128ms"},"msg":"","time":"2019-04-03T01:49:57.082Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d4471a40-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"2855","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:49:57.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1130-A/Dm/zyaF4T+dl1cvMLTv9UPG0k\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"127ms"},"msg":"","time":"2019-04-03T01:50:16.679Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f74a4490-55b2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"214b7-TwyQ8GbBbOvHVWHnTN++UKRa9rU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"87ms"},"msg":"","time":"2019-04-03T01:51:15.379Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"32cd8ef0-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"214b7-TwyQ8GbBbOvHVWHnTN++UKRa9rU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T01:52:55.189Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6169c760-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"214b7-TwyQ8GbBbOvHVWHnTN++UKRa9rU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T01:54:13.382Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8177a680-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3039","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"h2\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/）：\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:50:16.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"11e8-g86NKnVdxcUFzuOKX/DQc8hXq24\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"139ms"},"msg":"","time":"2019-04-03T01:55:07.254Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"872b9c80-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"135780","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryAdlvcWO8T3SlECei","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-2vtVp4PoYrPSCQ3t6y7HLvnmSJc\""},"statusCode":201,"responseTime":"136ms"},"msg":"","time":"2019-04-03T01:55:16.819Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a0a67040-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3196","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"h2\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:55:07.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1271-KiieGJd8MfdsK5a+coVViO/aPhI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"129ms"},"msg":"","time":"2019-04-03T01:55:59.561Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a2d18da0-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","params":{"slug":"spring-cloud-gatewayzhi-jia-gou-she-ji"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"9912-I/TS1GLvOP5GRJJMzHc3DSocVn8\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","etag":"W/\"9912-I/TS1GLvOP5GRJJMzHc3DSocVn8\""},"statusCode":304,"responseTime":"173ms"},"msg":"","time":"2019-04-03T01:56:03.241Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a31155c0-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T01:56:03.488Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a49bc650-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"5e00-pAPMUDIRWQ3Kg62RHyFnexTprUw\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6150-RJIfSTHZ+OmCKpzgwtigiyCMmpE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"82ms"},"msg":"","time":"2019-04-03T01:56:06.153Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a4b345f0-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904309-54-01.png","method":"GET","originalUrl":"/content/images/2019/04/201904309-54-01.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 01:55:16 GMT","etag":"W/\"18553-169e0e856ca\"","content-type":"image/png","content-length":99667},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T01:56:06.227Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ae7e71e0-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21824-S6bTtX2lVKr+tUMdqALjtJgMKT8\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T01:56:22.705Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b4be7b40-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3215","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"h2\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[10,2],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:55:59.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1284-epKqYsH2TZxtVRa8WdknqpFdz1A\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"140ms"},"msg":"","time":"2019-04-03T01:56:33.283Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b5ffadd0-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6150-RJIfSTHZ+OmCKpzgwtigiyCMmpE\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6182-EOQdCL4Rl5R89iaviabnrLdz8uc\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T01:56:35.314Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b61fe000-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T01:56:35.459Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cd46b1a0-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/","params":{},"headers":{"x-forwarded-for":"101.132.144.145","x-forwarded-proto":"https","x-real-ip":"101.132.144.145","host":"www.lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:36.0) Gecko/20100101 Firefox/36.0","accept":"text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","content-length":"32690","etag":"W/\"7fb2-6Aq0/cYP1s9GcA3VvbGTO4qr8t4\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"139ms"},"msg":"","time":"2019-04-03T01:57:14.441Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e482e000-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3223","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[10,2],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:56:33.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"128c-re1Fm06tKPeFNU9ugfhATpLmXm4\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"162ms"},"msg":"","time":"2019-04-03T01:57:53.448Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e5f9c890-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6182-EOQdCL4Rl5R89iaviabnrLdz8uc\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"618b-ENc2lkxNB4RoKZFELcJS2WNbnWY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"84ms"},"msg":"","time":"2019-04-03T01:57:55.822Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e621c2f0-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T01:57:56.002Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f44d3bc0-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"218cc-9xUSbL5A/4Usc/r3Zoo4Hp/HEc4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"69ms"},"msg":"","time":"2019-04-03T01:58:19.842Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fcc64530-55b3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3260","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[10,2],[1,\"p\",[[0,[],0,\"“　预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:57:53.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"12b1-tslX2V80px21wTA1mV11tnmf+bo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"127ms"},"msg":"","time":"2019-04-03T01:58:34.116Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fe7e2e60-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"618b-ENc2lkxNB4RoKZFELcJS2WNbnWY\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"61aa-GK2C5mKXRIVf5iNj5pXB2QacImo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"92ms"},"msg":"","time":"2019-04-03T01:58:36.964Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fea31b80-55b3-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T01:58:37.115Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"05552090-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3263","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:58:34.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"12b4-BMxtwxK5w7wqeqnyQkTS6vn2hA4\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"160ms"},"msg":"","time":"2019-04-03T01:58:48.508Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"067a66b0-55b4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"61aa-GK2C5mKXRIVf5iNj5pXB2QacImo\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"61b6-VVtAL2BXW9Ae411BxWpFz2nS1HA\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"213ms"},"msg":"","time":"2019-04-03T01:58:50.482Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"06af0b40-55b4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T01:58:50.615Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1112a6a0-55b4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/","params":{},"headers":{"x-forwarded-for":"47.92.74.243","x-forwarded-proto":"https","x-real-ip":"47.92.74.243","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:36.0) Gecko/20100101 Firefox/36.0","accept":"text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","content-length":"32690","etag":"W/\"7fb2-6Aq0/cYP1s9GcA3VvbGTO4qr8t4\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"80ms"},"msg":"","time":"2019-04-03T01:59:08.124Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2871ed60-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21937-h8qjwvEamdNiESb3u15KMe4xrMs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T01:59:47.301Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"37b84c10-55b4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/","params":{},"headers":{"x-forwarded-for":"106.14.168.238","x-forwarded-proto":"http","x-real-ip":"106.14.168.238","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:36.0) Gecko/20100101 Firefox/36.0","accept":"text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=31536000","location":"https://lancexlab.cn/","vary":"Accept, Accept-Encoding","content-type":"text/html; charset=utf-8","content-length":"98"},"statusCode":301,"responseTime":"1ms"},"msg":"","time":"2019-04-03T02:00:12.884Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"37cb85f0-55b4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/","params":{},"headers":{"x-forwarded-for":"106.14.168.238","x-forwarded-proto":"https","x-real-ip":"106.14.168.238","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:36.0) Gecko/20100101 Firefox/36.0","accept":"text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","content-length":"32690","etag":"W/\"7fb2-6Aq0/cYP1s9GcA3VvbGTO4qr8t4\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"81ms"},"msg":"","time":"2019-04-03T02:00:13.089Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"61370220-55b4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/","params":{},"headers":{"x-forwarded-for":"47.98.60.52","x-forwarded-proto":"https","x-real-ip":"47.98.60.52","host":"www.lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:36.0) Gecko/20100101 Firefox/36.0","accept":"text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","content-length":"32690","etag":"W/\"7fb2-6Aq0/cYP1s9GcA3VvbGTO4qr8t4\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T02:01:22.560Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"77810850-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21937-h8qjwvEamdNiESb3u15KMe4xrMs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T02:01:59.945Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9732e4c0-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3448","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序ｉd，gateway是通过同时实现Ordered接口来实现的。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T01:58:48.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"136d-CbE6kjrT4Zbf6riz/WdDeF0/1Wk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"137ms"},"msg":"","time":"2019-04-03T02:02:53.208Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9d95b860-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3448","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序ｉd，gateway是通过同时实现Ordered接口来实现的。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:02:53.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"136d-CbE6kjrT4Zbf6riz/WdDeF0/1Wk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"89ms"},"msg":"","time":"2019-04-03T02:03:03.873Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9dca8400-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3448","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序ｉd，gateway是通过同时实现Ordered接口来实现的。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:02:53.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"136d-CbE6kjrT4Zbf6riz/WdDeF0/1Wk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"91ms"},"msg":"","time":"2019-04-03T02:03:04.222Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9e0a7330-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3448","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序ｉd，gateway是通过同时实现Ordered接口来实现的。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:02:53.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"136d-CbE6kjrT4Zbf6riz/WdDeF0/1Wk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"116ms"},"msg":"","time":"2019-04-03T02:03:04.666Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"afcbbcf0-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3478","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序ｉd，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:02:53.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"138b-qUzlEn6rocPV+3Nyj51y1g/Rv9w\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"101ms"},"msg":"","time":"2019-04-03T02:03:34.440Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b5b9fcd0-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21b95-/5tsiVVDV5/UDKdLscZLoPZFOUE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"39ms"},"msg":"","time":"2019-04-03T02:03:44.325Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c6e10260-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3520","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:03:34.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"13b5-16pJDOsAXO9/OJay1nBhdAx+HEo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"145ms"},"msg":"","time":"2019-04-03T02:04:13.209Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cb050990-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"129ms"},"msg":"","time":"2019-04-03T02:04:20.144Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cbcb8de0-55b4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3520","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:04:13.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"13b5-16pJDOsAXO9/OJay1nBhdAx+HEo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"84ms"},"msg":"","time":"2019-04-03T02:04:21.397Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"293f8120-55b5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T02:06:58.164Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"70319550-55b5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"67ms"},"msg":"","time":"2019-04-03T02:08:57.194Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"746ea2c0-55b5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T02:09:04.300Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e41dcab0-55b5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T02:12:11.661Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2e454050-55b6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T02:14:16.077Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"31ddf770-55b6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T02:14:22.102Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"aad0f2e0-55b6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T02:17:45.032Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c4f30320-55b6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"42788","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryjGBSTIuc7kJ42AFo","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-zxjKCb4tNuORhiL9+vsTwLVvwUI\""},"statusCode":201,"responseTime":"74ms"},"msg":"","time":"2019-04-03T02:18:28.894Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"de0a3310-55b6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"82ms"},"msg":"","time":"2019-04-03T02:19:10.996Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e350c140-55b6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.173.185.40","x-forwarded-proto":"https","x-real-ip":"35.173.185.40","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T02:19:19.819Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"538d0e00-55b7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21c13-EfSAYnGV4TEfnyNV4CJia8SgxM0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T02:22:28.115Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"77dbcb20-55b7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3874","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]],[10,3],[1,\"p\",[[0,[],0,\"从接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:04:13.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1503-SSj5zK3iPi75/Jb3c7Se+R8bfIk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"166ms"},"msg":"","time":"2019-04-03T02:23:29.147Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7a63fca0-55b7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3874","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter\"]]],[10,3],[1,\"p\",[[0,[],0,\"从接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:23:29.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1503-SSj5zK3iPi75/Jb3c7Se+R8bfIk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"183ms"},"msg":"","time":"2019-04-03T02:23:33.411Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"83096d40-55b7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T02:23:47.789Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"aef5a0e0-55b7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T02:25:01.477Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b254d170-55b7-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"61b6-VVtAL2BXW9Ae411BxWpFz2nS1HA\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6451-u0FxAqwDmbfr6Q1fCDTNbifeKow\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"85ms"},"msg":"","time":"2019-04-03T02:25:07.165Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b269e010-55b7-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-18-12.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-18-12.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:18:28 GMT","etag":"W/\"8401-169e0fd9497\"","content-type":"image/png","content-length":33793},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T02:25:07.220Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b27ccbd0-55b7-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T02:25:07.345Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"195a1bf0-55b8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.88.162.238","x-forwarded-proto":"https","x-real-ip":"3.88.162.238","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"67ms"},"msg":"","time":"2019-04-03T02:27:59.987Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"35fe4330-55b8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"67ms"},"msg":"","time":"2019-04-03T02:28:48.040Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7273b5c0-55b8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T02:30:29.458Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8f5e82f0-55b8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"78.85.188.210","x-forwarded-proto":"https","x-real-ip":"78.85.188.210","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 (.NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)","accept":"image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*","cache-control":"no-store,no-cache","pragma":"no-cache"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","content-length":"25681","etag":"W/\"6451-u0FxAqwDmbfr6Q1fCDTNbifeKow\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"82ms"},"msg":"","time":"2019-04-03T02:31:18.002Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d6c10c30-55b8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T02:33:17.731Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"dad36020-55b8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.209.189.117","x-forwarded-proto":"https","x-real-ip":"54.209.189.117","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"73ms"},"msg":"","time":"2019-04-03T02:33:24.589Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"10c69030-55b9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T02:34:55.086Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8dfb7b10-55b9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T02:38:25.152Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9ed1efa0-55b9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T02:38:53.393Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cc874a80-55b9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"21fe9-R6ldaVkaatdmnFUtJJ3+gfICJMU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T02:40:10.094Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"469c7ed0-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3884","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:23:29.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"150d-rlioHAEPJDRhjvv/oPowXwQHmXU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"251ms"},"msg":"","time":"2019-04-03T02:43:35.099Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4cd18bb0-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22007-jNZXGuNIz3feMGwIwSnUagspaxg\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T02:43:45.317Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4f5613b0-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3909","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:43:34.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1526-REGB+kfBFlPJeRk21iT0XyWFE2s\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"181ms"},"msg":"","time":"2019-04-03T02:43:49.667Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5242fa70-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"3909","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:43:49.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1526-REGB+kfBFlPJeRk21iT0XyWFE2s\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"85ms"},"msg":"","time":"2019-04-03T02:43:54.478Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"54416280-55ba-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6451-u0FxAqwDmbfr6Q1fCDTNbifeKow\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6467-IKTTB8hEAXLlrriM4XQFqnXJIDY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"129ms"},"msg":"","time":"2019-04-03T02:43:57.866Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"546e17d0-55ba-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"3ms"},"msg":"","time":"2019-04-03T02:43:58.034Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"63728b80-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22038-JV4DQ0VUjz1QmYfAQfvdtmITw7c\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"62ms"},"msg":"","time":"2019-04-03T02:44:23.287Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6d8e6f80-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.198.16.118","x-forwarded-proto":"https","x-real-ip":"54.198.16.118","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22038-JV4DQ0VUjz1QmYfAQfvdtmITw7c\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"74ms"},"msg":"","time":"2019-04-03T02:44:40.259Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e446e440-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22038-JV4DQ0VUjz1QmYfAQfvdtmITw7c\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T02:47:59.412Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e4edd2a0-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"51065","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryMrNfjAt2hCBQQRz3","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-d5LDOTfSNm/zzNIJAiEjVlomwQA\""},"statusCode":201,"responseTime":"98ms"},"msg":"","time":"2019-04-03T02:48:00.557Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ff7b75f0-55ba-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.200.216.185","x-forwarded-proto":"https","x-real-ip":"34.200.216.185","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22038-W4SBAKzUZJ5DW4LLRLTlXu/PYmo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T02:48:45.067Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0aecd7d0-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"4134","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}]],\"markups\":[],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:43:49.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T01:46:39.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T01:46:39.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"15f3-sarzPJd07GosrUDfuIz3B3ArlIs\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"123ms"},"msg":"","time":"2019-04-03T02:49:04.334Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0edeab70-55bb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6467-IKTTB8hEAXLlrriM4XQFqnXJIDY\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"65a0-9rgkEyXgmtLH2gJLmDxEfNDXb1w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"70ms"},"msg":"","time":"2019-04-03T02:49:10.894Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0ef42f40-55bb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-47-50.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-47-50.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:48:00 GMT","etag":"W/\"9898-169e1189d1e\"","content-type":"image/png","content-length":39064},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T02:49:10.968Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0f35f330-55bb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T02:49:11.398Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"19ae9d30-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"222a7-rNr2/7MiPPs3bYf12Z42iSi7rBk\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T02:49:29.033Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7bef0ca0-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"4383","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*包下的全局过滤器罗列出来，org.iblog.enhance.gateway.filter.*包下的均是增强实现的拦截功能。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:49:04.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"16ec-DF87owCa05ZUMYFnSqV+tQxV9iw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"121ms"},"msg":"","time":"2019-04-03T02:52:13.926Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7c420ea0-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"4383","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*包下的全局过滤器罗列出来，org.iblog.enhance.gateway.filter.*包下的均是增强实现的拦截功能。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:52:13.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"16ec-DF87owCa05ZUMYFnSqV+tQxV9iw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"174ms"},"msg":"","time":"2019-04-03T02:52:14.522Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7c8447c0-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"4383","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*包下的全局过滤器罗列出来，org.iblog.enhance.gateway.filter.*包下的均是增强实现的拦截功能。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:52:13.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"16ec-DF87owCa05ZUMYFnSqV+tQxV9iw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"80ms"},"msg":"","time":"2019-04-03T02:52:14.862Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7ee8ebb0-55bb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"65a0-9rgkEyXgmtLH2gJLmDxEfNDXb1w\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"667c-p7v5GTr3fTmVC7vKDmYnXHNQIAk\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"79ms"},"msg":"","time":"2019-04-03T02:52:18.875Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7f0d3c90-55bb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T02:52:19.037Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8b7e0d10-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22546-bPCqPaLuprRd8fVM15rLdXAHfCE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T02:52:39.950Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"92a34650-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"4426","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:52:13.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1717-HIsyB8gxTXo0/Z00bhlqaljcvOE\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"157ms"},"msg":"","time":"2019-04-03T02:52:52.054Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"93b9bf60-55bb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"667c-p7v5GTr3fTmVC7vKDmYnXHNQIAk\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"668d-b+wA3P3aE3DIPKgyOuaZwZissfs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"94ms"},"msg":"","time":"2019-04-03T02:52:53.813Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"93deac80-55bb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T02:52:53.963Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b08f56e0-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.87.171.198","x-forwarded-proto":"https","x-real-ip":"3.87.171.198","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22582-wM2XxwP0QAS1eJgJ3Ftjkukp0w4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T02:53:42.141Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"be6b9e40-55bb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22582-wM2XxwP0QAS1eJgJ3Ftjkukp0w4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"44ms"},"msg":"","time":"2019-04-03T02:54:05.393Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"39c6c010-55bc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22582-wM2XxwP0QAS1eJgJ3Ftjkukp0w4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T02:57:32.353Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"57026c60-55bc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22582-wM2XxwP0QAS1eJgJ3Ftjkukp0w4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T02:58:21.403Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"779cd410-55bc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22582-wM2XxwP0QAS1eJgJ3Ftjkukp0w4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T02:59:16.101Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e00494c0-55bc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.200.216.185","x-forwarded-proto":"https","x-real-ip":"34.200.216.185","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22582-wM2XxwP0QAS1eJgJ3Ftjkukp0w4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"40ms"},"msg":"","time":"2019-04-03T03:02:11.253Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f4b5d280-55bc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.200.216.185","x-forwarded-proto":"https","x-real-ip":"34.200.216.185","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"22582-wM2XxwP0QAS1eJgJ3Ftjkukp0w4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T03:02:45.972Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1683ff40-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"4578","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648\\n* \"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T02:52:51.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"17af-1cpopCAJBu3CLhoKVEW4eHQq3XM\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"126ms"},"msg":"","time":"2019-04-03T03:03:42.773Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"19e579c0-55bd-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"668d-b+wA3P3aE3DIPKgyOuaZwZissfs\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6740-hX+uGwB7XCpNFI0E0Wo8eMhXVmQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T03:03:48.375Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1a073290-55bd-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T03:03:48.540Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"20074cc0-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2273a-EoNqs/rViJkusc/rGZW0oThfjt4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T03:03:58.664Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2e22e710-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"4657","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* \"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:03:42.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"17fe-2ZVzJGq1pnIsgQVbM4lImYsC5mI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"280ms"},"msg":"","time":"2019-04-03T03:04:22.557Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a11ca620-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2282d-0KI077Ic1EbXJx4AqFxeIjnXwlg\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T03:07:35.214Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"bc245b70-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6005","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:04:22.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1d42-itMexNuk7mK9DtxAi4E6EMQIuk8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"123ms"},"msg":"","time":"2019-04-03T03:08:20.645Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"bcf0fa40-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23884-+s/1KUo/SMp4LlpKpD32czTJWWo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"67ms"},"msg":"","time":"2019-04-03T03:08:21.929Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"be6c76b0-55bd-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6740-hX+uGwB7XCpNFI0E0Wo8eMhXVmQ\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6d23-dcMIefbecYM3n5W1Sn7FWTSVRV4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"71ms"},"msg":"","time":"2019-04-03T03:08:24.419Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"be9868b0-55bd-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:08:24.638Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d8050ba0-55bd-11e9-a41f-1dc48d552e2c","userId":null},"url":"/rss/","method":"GET","originalUrl":"/rss/","params":{},"headers":{"x-forwarded-for":"62.210.215.110","x-forwarded-proto":"https","x-real-ip":"62.210.215.110","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.66 Safari/537.36","cache-control":"max-age=0, no-cache","pragma":"no-cache","accept-encoding":"gzip"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/xml; charset=utf-8","etag":"W/\"c5e8-F1ua+IJZqsiIiJE0BPsRpHm4OZI\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"85ms"},"msg":"","time":"2019-04-03T03:09:07.377Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e0dab400-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23884-+s/1KUo/SMp4LlpKpD32czTJWWo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T03:09:22.160Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e2024410-55bd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6039","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的图片\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:08:20.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1d64-ypT1iOj5WdzB1eJHxIKzdc0eh1g\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"172ms"},"msg":"","time":"2019-04-03T03:09:24.225Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e9ffdbf0-55bd-11e9-a41f-1dc48d552e2c","userId":null},"url":"/tag/spring-cloud-gateway/","method":"GET","originalUrl":"/tag/spring-cloud-gateway/","params":{"slug":"spring-cloud-gateway"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"4b06-oFjzF3BvtMebG0C0aH7BTfhbiec\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"4b06-7xNf6RXKzKxkZRB+rjiQNJuwT2w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T03:09:37.502Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"eaf1b600-55bd-11e9-a41f-1dc48d552e2c","userId":null},"url":"/wang-guan-ying-yong-chu-tan/","method":"GET","originalUrl":"/wang-guan-ying-yong-chu-tan/","params":{"slug":"wang-guan-ying-yong-chu-tan"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"9866-34G7n6vWxpkO3yvWPoX6+KTRgjQ\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"95b3-JsuZhBZWKPu7HIF2dzRrWgd2Z/I\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"88ms"},"msg":"","time":"2019-04-03T03:09:39.130Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1b60b2a0-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6194","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:09:24.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1deb-H+AEFruFWrT9L0Ppa0NxCCYKhOo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"135ms"},"msg":"","time":"2019-04-03T03:11:00.436Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1f010ae0-55be-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6d23-dcMIefbecYM3n5W1Sn7FWTSVRV4\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6dd5-fbw6E/AOka8E4c9IPBoIQ8WwZnw\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"171ms"},"msg":"","time":"2019-04-03T03:11:06.560Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"47d2b810-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:11:00.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"162ms"},"msg":"","time":"2019-04-03T03:12:15.030Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"48ba58f0-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"84ms"},"msg":"","time":"2019-04-03T03:12:16.469Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4921a640-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"113ms"},"msg":"","time":"2019-04-03T03:12:17.177Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4969f9e0-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"73ms"},"msg":"","time":"2019-04-03T03:12:17.610Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"49ac5a10-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"83ms"},"msg":"","time":"2019-04-03T03:12:18.054Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"49ebd410-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"80ms"},"msg":"","time":"2019-04-03T03:12:18.468Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4a2b9c30-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"133ms"},"msg":"","time":"2019-04-03T03:12:18.938Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4a6c4eb0-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"69ms"},"msg":"","time":"2019-04-03T03:12:19.298Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4aa5ae30-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6252","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e25-s944KocjCbSn6oC44CqbxNUgZZo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"79ms"},"msg":"","time":"2019-04-03T03:12:19.684Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"605c9c20-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23aa2-AHManIsWHaocsWJs2hfeZ3DGrI4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"39ms"},"msg":"","time":"2019-04-03T03:12:56.075Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6a3eab70-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6327","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:12:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1e70-QvHC0DaT/f10vkHEEqIfrT+4BMM\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"135ms"},"msg":"","time":"2019-04-03T03:13:12.752Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6cbe9f90-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6327","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:13:12.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"1e70-QvHC0DaT/f10vkHEEqIfrT+4BMM\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"106ms"},"msg":"","time":"2019-04-03T03:13:16.920Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6ef814d0-55be-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6dd5-fbw6E/AOka8E4c9IPBoIQ8WwZnw\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6e5a-7pKGZ8UzeP+zsc6U4swIOu2NEi4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T03:13:20.598Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f1bf080-55be-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T03:13:20.779Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"707761d0-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.200.216.185","x-forwarded-proto":"https","x-real-ip":"34.200.216.185","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23b83-DSwaR1opX1dr6MuSFncAedPEdhc\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"38ms"},"msg":"","time":"2019-04-03T03:13:23.093Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"95e2b280-55be-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23b83-DSwaR1opX1dr6MuSFncAedPEdhc\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"44ms"},"msg":"","time":"2019-04-03T03:14:25.880Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0924c530-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6389","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:13:12.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1eae-AagMhQl082u79MWaIBblYGWBcKc\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"125ms"},"msg":"","time":"2019-04-03T03:17:39.332Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1fa98a70-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23c16-P4MRVR8z/MLtrQGfSz7I7ORvTDE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"130ms"},"msg":"","time":"2019-04-03T03:18:17.122Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"215bf560-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23c16-P4MRVR8z/MLtrQGfSz7I7ORvTDE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"44ms"},"msg":"","time":"2019-04-03T03:18:19.875Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"40492240-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6413","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n*org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter\"]]],[1,\"p\",[[0,[],0,\"优先级：\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:17:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1ec6-XXbWsPkyZXjL5vl6HFEAGOSqdEI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"158ms"},"msg":"","time":"2019-04-03T03:19:11.887Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4498cd50-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6416","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n*　org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter\"]]],[1,\"p\",[[0,[],0,\"优先级：\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:19:11.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1ec9-b59T61v93F+Wq08BdgEAXSiYWm8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"130ms"},"msg":"","time":"2019-04-03T03:19:19.082Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"46216920-55bf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6e5a-7pKGZ8UzeP+zsc6U4swIOu2NEi4\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6ea0-gq4wA0bE11VEw4Lyun28/JcJpjo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"71ms"},"msg":"","time":"2019-04-03T03:19:21.595Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"46498a90-55bf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:19:21.788Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4e022a30-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6414","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter\"]]],[1,\"p\",[[0,[],0,\"优先级：\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:19:18.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1ec7-XdN+jVYd6J1RlnbRoafffN9Foj8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"119ms"},"msg":"","time":"2019-04-03T03:19:34.861Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"50b3b5a0-55bf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6ea0-gq4wA0bE11VEw4Lyun28/JcJpjo\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"6ea1-Oa42fWN9ZYa8WuNrjDX/Iub0ygQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T03:19:39.317Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"50d6ce00-55bf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:19:39.491Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"57734f40-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6395","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"p\",[[0,[],0,\"MarkRequestFilter\"]]],[1,\"p\",[[0,[],0,\"优先级：\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:19:34.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1eb4-76KskG7qryqg94KeFRog97MzZsA\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"163ms"},"msg":"","time":"2019-04-03T03:19:50.746Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5b571920-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23c17-Dys8O55+G34N5K0RKmV1Jg8TNGg\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T03:19:57.160Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6ad1ce40-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6424","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　｜　优先级：-2147483647\"]]],[1,\"p\",[]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:19:50.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1ed1-VyRHyjJOnyBHvxQyIbwle5kKImI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"130ms"},"msg":"","time":"2019-04-03T03:20:23.210Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6c5c3ed0-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6422","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:20:23.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1ecf-s22VTYbKoA6hd0WE1j+1m+ceJKo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"152ms"},"msg":"","time":"2019-04-03T03:20:25.817Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"865f5560-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6480","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:20:25.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1f09-lZDRWuiSBUxtfG99IudZD0lVupk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"128ms"},"msg":"","time":"2019-04-03T03:21:09.432Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"aacd0c30-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6546","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:21:09.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1f4b-DaHXHyVj718QUMf+hv/Th24AyF4\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"229ms"},"msg":"","time":"2019-04-03T03:22:10.651Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c5bbe250-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6601","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:22:10.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1f82-YQeGoHgKJ4cOhM9K2AVrzUiLcMU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"234ms"},"msg":"","time":"2019-04-03T03:22:55.843Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d59c8530-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23e67-sD0iayG6H97tZGNu41xjlKAJkFE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T03:23:22.303Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e5b6aea0-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.200.216.185","x-forwarded-proto":"https","x-real-ip":"34.200.216.185","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23e67-sD0iayG6H97tZGNu41xjlKAJkFE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T03:23:49.317Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ef29f690-55bf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6658","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:22:55.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"1fbb-tJUoqS6tt+e8coQo24YooLPMhgo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"155ms"},"msg":"","time":"2019-04-03T03:24:05.271Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"08d55030-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"23f12-A7EbKOmEG94qF8MhxkaEAVjFWdg\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T03:24:48.228Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"09db2770-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"42431","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryjI3gAWHEdaBbB1Cl","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-xVazsrE2MMMeKURF7APYxALQYHA\""},"statusCode":201,"responseTime":"74ms"},"msg":"","time":"2019-04-03T03:24:49.970Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0a6fc650-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6755","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,7],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:24:05.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2008-I7BDyo6n31L/HSi/HtWcGhJkEeI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"217ms"},"msg":"","time":"2019-04-03T03:24:51.088Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0dbf6680-55c0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"6ea1-Oa42fWN9ZYa8WuNrjDX/Iub0ygQ\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"7047-YnorjxaDu8eTM34Fnm/OnApLUpM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"81ms"},"msg":"","time":"2019-04-03T03:24:56.507Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0dd5ada0-55c0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-24-39.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-24-39.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:24:49 GMT","etag":"W/\"83e5-169e13a53ac\"","content-type":"image/png","content-length":33765},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:24:56.573Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0de8c070-55c0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:24:56.698Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"32117f00-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6836","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,7],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　｜　优先级：-2147482648\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:24:50.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2059-+lM1gh8zPqr2I2I537W3WPZgqmE\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"178ms"},"msg":"","time":"2019-04-03T03:25:57.541Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3460ed40-55c0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"7047-YnorjxaDu8eTM34Fnm/OnApLUpM\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"709b-U3u+k2QsO7B7DhOZ/uHh31dA64A\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"217ms"},"msg":"","time":"2019-04-03T03:26:01.461Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"349fa3f0-55c0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:26:01.651Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"548f9ad0-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"6874","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　｜　优先级：-2147482648\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:25:57.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"207f-LUBKUoaxOVdgYFOlXVJl/6RIBgk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"175ms"},"msg":"","time":"2019-04-03T03:26:55.408Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6e9c9c70-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2422c-yEVnwaIC6skYtBRKBF5DntKCeoM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"62ms"},"msg":"","time":"2019-04-03T03:27:38.999Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ae0e5f10-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2422c-yEVnwaIC6skYtBRKBF5DntKCeoM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T03:29:25.424Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"be8108c0-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.200.216.185","x-forwarded-proto":"https","x-real-ip":"34.200.216.185","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2422c-yEVnwaIC6skYtBRKBF5DntKCeoM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T03:29:53.027Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ee1dc140-55c0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7214","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　｜　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:26:55.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"21d3-D2vIS0dLhX2qw7rgoHGh6Z5M61o\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"180ms"},"msg":"","time":"2019-04-03T03:31:13.034Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"28363100-55c1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245fd-IRuGkAbgbeyJKQJYyoYhUbHj+TY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T03:32:50.365Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5162f680-55c1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245fd-IRuGkAbgbeyJKQJYyoYhUbHj+TY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T03:33:59.452Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7aba7580-55c1-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"709b-U3u+k2QsO7B7DhOZ/uHh31dA64A\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"7240-by8vwsJGa+3HKmZ6srnrqL+IQIE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"95ms"},"msg":"","time":"2019-04-03T03:35:08.857Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7ae6b5a0-55c1-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:35:09.053Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7e0b2720-55c1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245fd-IRuGkAbgbeyJKQJYyoYhUbHj+TY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T03:35:14.377Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8935e310-55c1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7212","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:31:12.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"21d1-b/wRiJd38HUXG0e9rAw4KyrBpXc\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"144ms"},"msg":"","time":"2019-04-03T03:35:33.205Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e7cf6a90-55c1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.215.231.197","x-forwarded-proto":"https","x-real-ip":"18.215.231.197","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T03:38:11.818Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"08834db0-55c2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T03:39:06.693Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"306d8110-55c2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.200.216.185","x-forwarded-proto":"https","x-real-ip":"34.200.216.185","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"135ms"},"msg":"","time":"2019-04-03T03:40:13.738Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ac5d41c0-55c2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"74ms"},"msg":"","time":"2019-04-03T03:43:41.608Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b3ee8340-55c2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T03:43:54.297Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f91b8ee0-55c2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T03:45:50.330Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"73b70a30-55c3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"81ms"},"msg":"","time":"2019-04-03T03:49:16.069Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"76b46bb0-55c3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T03:49:21.056Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3a5b340-55c3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T03:50:36.456Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1f304980-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T03:54:03.723Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"231b1840-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"77ms"},"msg":"","time":"2019-04-03T03:54:10.323Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"53c63380-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"245f7-iHrdU/7dWTNnL9VSLhAmf5v/UFQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T03:55:31.956Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6a2e21f0-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7395","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:35:33.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T02:48:00.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T02:48:00.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2288-nWAoNFAUFRkih3jTh8IFI7zc1X4\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"234ms"},"msg":"","time":"2019-04-03T03:56:09.724Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6aa092d0-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7395","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:56:09.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T03:56:09.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T03:56:09.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"2288-nWAoNFAUFRkih3jTh8IFI7zc1X4\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"201ms"},"msg":"","time":"2019-04-03T03:56:10.442Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9501b9a0-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"57457","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryyZa0IrOdLhUsrTNi","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-4xr96PBPZRjNqFuVpGikpRfir4Q\""},"statusCode":201,"responseTime":"94ms"},"msg":"","time":"2019-04-03T03:57:21.434Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9681c9f0-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7506","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:56:09.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T03:56:09.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T03:56:09.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"22e3-dOhwP0Xo/SaxTKOK6YwMQPB1E80\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"132ms"},"msg":"","time":"2019-04-03T03:57:23.990Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9d3f40b0-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7526","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:57:23.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T03:56:09.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T03:56:09.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"22f7-zhSSvOJY67Jj/I5oaYZF/9mRfME\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"177ms"},"msg":"","time":"2019-04-03T03:57:35.343Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9f9c1c70-55c4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"7240-by8vwsJGa+3HKmZ6srnrqL+IQIE\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"73e6-NXKJ+Gibu3FhacQ3fDGziFiyQ6k\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"107ms"},"msg":"","time":"2019-04-03T03:57:39.236Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9fb549c0-55c4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-57-06.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-57-06.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:57:21 GMT","etag":"W/\"b527-169e1581a91\"","content-type":"image/png","content-length":46375},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:57:39.295Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9fca0a40-55c4-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T03:57:39.432Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d3a6b660-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T03:59:06.486Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"dfdf38d0-55c4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T03:59:26.995Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"18648570-55c5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T04:01:01.819Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"88944f10-55c5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.170.67.193","x-forwarded-proto":"https","x-real-ip":"35.170.67.193","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T04:04:10.039Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ad5cf720-55c5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T04:05:11.757Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cfc34530-55c5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T04:06:09.458Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2edb7290-55c6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T04:08:49.013Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4674dc20-55c6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T04:09:28.597Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"92969b20-55c6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"76ms"},"msg":"","time":"2019-04-03T04:11:36.352Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e6cc8740-55c6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"163ms"},"msg":"","time":"2019-04-03T04:13:57.722Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"eccf6090-55c6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T04:14:07.698Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"49df88f0-55c7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T04:16:43.825Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"87e00850-55c7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T04:18:27.861Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"96cf9470-55c7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T04:18:52.912Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"132012c0-55c8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"44ms"},"msg":"","time":"2019-04-03T04:22:21.465Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"34653960-55c8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"66ms"},"msg":"","time":"2019-04-03T04:23:17.305Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4d8b0f50-55c8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"64ms"},"msg":"","time":"2019-04-03T04:23:59.494Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"dbd6ac10-55c8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T04:27:58.203Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e0d97a80-55c8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T04:28:06.621Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ecef80d0-55c8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T04:28:26.898Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"83d0afb0-55c9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T04:32:40.027Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"86e91340-55c9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T04:32:45.220Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a85b8b70-55c9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T04:33:41.338Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"41e54510-55ca-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T04:37:58.938Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4a0fb950-55ca-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"137ms"},"msg":"","time":"2019-04-03T04:38:12.721Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4befc3f0-55ca-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T04:38:15.772Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f37078e0-55ca-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"88ms"},"msg":"","time":"2019-04-03T04:42:56.840Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f4d70dc0-55ca-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"77ms"},"msg":"","time":"2019-04-03T04:42:59.178Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fa3bf960-55ca-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.181.97","x-forwarded-proto":"https","x-real-ip":"18.234.181.97","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T04:43:08.200Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"93706710-55cb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"66ms"},"msg":"","time":"2019-04-03T04:47:25.258Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"95cad1d0-55cb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"65ms"},"msg":"","time":"2019-04-03T04:47:29.200Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3adf700-55cb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T04:47:52.494Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"40eca250-55cc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"66ms"},"msg":"","time":"2019-04-03T04:52:16.312Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4d9858f0-55cc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.209.221.21","x-forwarded-proto":"https","x-real-ip":"18.209.221.21","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"62ms"},"msg":"","time":"2019-04-03T04:52:37.566Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6c10f210-55cc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T04:53:28.678Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fef1f570-55cc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T04:57:35.099Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1a2304b0-55cd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T04:58:20.710Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"38144560-55cd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"112ms"},"msg":"","time":"2019-04-03T04:59:11.015Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c0ec2970-55cd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"80ms"},"msg":"","time":"2019-04-03T05:03:00.569Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d23758d0-55cd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.146.164.192","x-forwarded-proto":"https","x-real-ip":"54.146.164.192","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"146ms"},"msg":"","time":"2019-04-03T05:03:29.649Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e7b3fce0-55cd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.146.164.192","x-forwarded-proto":"https","x-real-ip":"54.146.164.192","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T05:04:05.605Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"60756100-55ce-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.230.44.155","x-forwarded-proto":"https","x-real-ip":"34.230.44.155","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T05:07:28.198Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"881b1150-55ce-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T05:08:34.718Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"93d5ff50-55ce-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T05:08:54.384Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fb05dc40-55ce-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T05:11:47.511Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"35bab310-55cf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T05:13:26.003Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"40904a20-55cf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T05:13:44.173Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"446ebcd0-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-jia-gou-she-ji/","params":{"slug":"spring-cloud-gatewayzhi-jia-gou-she-ji"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","if-none-match":"W/\"9912-I/TS1GLvOP5GRJJMzHc3DSocVn8\"","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"9912-ddQRiVz7y1VJitszTeXGuBLaGPw\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"120ms"},"msg":"","time":"2019-04-03T05:13:50.742Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"449b7220-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/size/w1000/2019/04/201904219-27-11.png","method":"GET","originalUrl":"/content/images/size/w1000/2019/04/201904219-27-11.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Tue, 02 Apr 2019 11:30:37 GMT","etag":"W/\"eaa17-169ddd0b929\"","content-type":"image/png","content-length":961047},"statusCode":200,"responseTime":"37ms"},"msg":"","time":"2019-04-03T05:13:50.952Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4772d510-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/tag/spring-cloud-gateway/","method":"GET","originalUrl":"/tag/spring-cloud-gateway/","params":{"slug":"spring-cloud-gateway"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-jia-gou-she-ji/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"4b06-OFLCDnEK4oOIc2R0dmwLxdQel7A\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T05:13:55.732Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"48f7a050-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/size/w1000/2019/04/201904219-27-11.png","method":"GET","originalUrl":"/content/images/size/w1000/2019/04/201904219-27-11.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Tue, 02 Apr 2019 11:30:37 GMT","etag":"W/\"eaa17-169ddd0b929\"","content-type":"image/png","content-length":961047},"statusCode":200,"responseTime":"5ms"},"msg":"","time":"2019-04-03T05:13:58.235Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"48faad90-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/size/w1000/2019/03/menu.saveimg.savepath20190328171657.jpg","method":"GET","originalUrl":"/content/images/size/w1000/2019/03/menu.saveimg.savepath20190328171657.jpg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Tue, 02 Apr 2019 14:18:02 GMT","etag":"W/\"15d6-169de6a0118\"","content-type":"image/jpeg","content-length":5590},"statusCode":200,"responseTime":"13ms"},"msg":"","time":"2019-04-03T05:13:58.263Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4fe83500-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"73e6-NXKJ+Gibu3FhacQ3fDGziFiyQ6k\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"95ms"},"msg":"","time":"2019-04-03T05:14:09.969Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5013d8e0-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-18-12.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-18-12.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:18:28 GMT","etag":"W/\"8401-169e0fd9497\"","content-type":"image/png","content-length":33793},"statusCode":200,"responseTime":"5ms"},"msg":"","time":"2019-04-03T05:14:10.165Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5013d8e3-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-24-39.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-24-39.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:24:49 GMT","etag":"W/\"83e5-169e13a53ac\"","content-type":"image/png","content-length":33765},"statusCode":200,"responseTime":"8ms"},"msg":"","time":"2019-04-03T05:14:10.167Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5013b1d0-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904309-54-01.png","method":"GET","originalUrl":"/content/images/2019/04/201904309-54-01.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 01:55:16 GMT","etag":"W/\"18553-169e0e856ca\"","content-type":"image/png","content-length":99667},"statusCode":200,"responseTime":"11ms"},"msg":"","time":"2019-04-03T05:14:10.169Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5013d8e1-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-47-50.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-47-50.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:48:00 GMT","etag":"W/\"9898-169e1189d1e\"","content-type":"image/png","content-length":39064},"statusCode":200,"responseTime":"11ms"},"msg":"","time":"2019-04-03T05:14:10.170Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5013d8e4-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-57-06.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-57-06.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:57:21 GMT","etag":"W/\"b527-169e1581a91\"","content-type":"image/png","content-length":46375},"statusCode":200,"responseTime":"13ms"},"msg":"","time":"2019-04-03T05:14:10.172Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5013d8e2-55cf-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/spring_cloud_gateway_diagram.png","method":"GET","originalUrl":"/content/images/2019/04/spring_cloud_gateway_diagram.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","accept-encoding":"br, gzip, deflate","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57 MicroMessenger/7.0.3(0x17000321) NetType/WIFI Language/zh_CN","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Mon, 01 Apr 2019 09:13:30 GMT","etag":"W/\"4138-169d82cd496\"","content-type":"image/png","content-length":16696},"statusCode":200,"responseTime":"16ms"},"msg":"","time":"2019-04-03T05:14:10.175Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a7426b90-55cf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T05:16:36.480Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"dd16c900-55cf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"60ms"},"msg":"","time":"2019-04-03T05:18:06.798Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f7a90030-55cf-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T05:18:51.358Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4149e0b0-55d0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"145ms"},"msg":"","time":"2019-04-03T05:20:54.990Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"96f8d840-55d0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"44ms"},"msg":"","time":"2019-04-03T05:23:18.641Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"976ef2a0-55d0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"69ms"},"msg":"","time":"2019-04-03T05:23:19.440Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d9f9b510-55d0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T05:25:11.061Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"322f0960-55d1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"60ms"},"msg":"","time":"2019-04-03T05:27:39.060Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3ab46ee0-55d1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T05:27:53.363Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8f092da0-55d1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T05:30:14.828Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ec9a6ce0-55d1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T05:32:51.819Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"eeb47340-55d1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T05:32:55.340Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"44032260-55d2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T05:35:18.452Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"95ccf080-55d2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T05:37:35.682Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"97a3d360-55d2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"82ms"},"msg":"","time":"2019-04-03T05:37:38.793Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f9b62df0-55d2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"39ms"},"msg":"","time":"2019-04-03T05:40:23.288Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"55e82b50-55d3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T05:42:57.974Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6303e1d0-55d3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"145ms"},"msg":"","time":"2019-04-03T05:43:20.064Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b81030c0-55d3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T05:45:42.661Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fae2d1a0-55d3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T05:47:34.762Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1ed84b30-55d4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T05:48:35.086Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"80cbd320-55d4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"84ms"},"msg":"","time":"2019-04-03T05:51:19.464Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c4035050-55d4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T05:53:12.194Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c6abb400-55d4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T05:53:16.658Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4ac39f00-55d5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.215.48","x-forwarded-proto":"https","x-real-ip":"18.204.215.48","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T05:56:58.270Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"89642ef0-55d5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T05:58:43.349Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8a87c760-55d5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"83ms"},"msg":"","time":"2019-04-03T05:58:45.290Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e9139340-55d5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T06:01:23.870Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2b2fb560-55d6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T06:03:14.793Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3110fcf0-55d6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"44ms"},"msg":"","time":"2019-04-03T06:03:24.652Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a87b83a0-55d6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T06:06:45.012Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cec155d0-55d6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T06:07:49.216Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fb1fd340-55d6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"150ms"},"msg":"","time":"2019-04-03T06:09:03.757Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"538d0070-55d7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T06:11:32.016Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"97ecf810-55d7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T06:13:26.716Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a83843a0-55d7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T06:13:54.068Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"16114c00-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"249c4-0US7kq+p3qpIFRY2e02sow4mgxU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"40ms"},"msg":"","time":"2019-04-03T06:16:58.346Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3dd0ecf0-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7601","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T03:57:35.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T03:56:09.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T03:56:09.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2342-sJusBJUxWp8U5wmeg6s8q1ZuYCI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"182ms"},"msg":"","time":"2019-04-03T06:18:05.176Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"427dfa40-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.24.73.103","x-forwarded-proto":"https","x-real-ip":"100.24.73.103","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"24aa5-Tb7NHKSg264Rm0o0IlROw2Eptmk\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"62ms"},"msg":"","time":"2019-04-03T06:18:12.900Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4f9ce510-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7671","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:18:05.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2388-FvKKutt9iqOu5bllZ6rxpVb34SU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"163ms"},"msg":"","time":"2019-04-03T06:18:35.016Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5acf1b10-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"24b6c-2yom/b0FEO97kfWQS5WP8FvrcZ8\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"71ms"},"msg":"","time":"2019-04-03T06:18:53.706Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9dcc2750-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7836","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:18:34.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"242d-eOqwGC2wcnzS9713tKFl3bbrjmY\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"187ms"},"msg":"","time":"2019-04-03T06:20:46.212Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b8be31c0-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7922","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:20:46.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2483-3El2wShqPrj1nmzs42itRY9nrj4\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"151ms"},"msg":"","time":"2019-04-03T06:21:31.382Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"caf6ce60-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"24e32-yxhELzmj6XCrgHkG1f/2hy2CybM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"60ms"},"msg":"","time":"2019-04-03T06:22:01.859Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cc535120-55d8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"73e6-NXKJ+Gibu3FhacQ3fDGziFiyQ6k\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"7563-ATfkXqgv1pZO1NCI+l2fXFLsWUI\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"212ms"},"msg":"","time":"2019-04-03T06:22:04.296Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cc969bb0-55d8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T06:22:04.526Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f5e67990-55d8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"24e32-yxhELzmj6XCrgHkG1f/2hy2CybM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T06:23:13.891Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1afeef50-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"24e32-yxhELzmj6XCrgHkG1f/2hy2CybM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"72ms"},"msg":"","time":"2019-04-03T06:24:16.143Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"37e6d650-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"7955","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:21:31.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"24a4-vLpWYbFXu7aP/qyE9Hw4WF9OnYg\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"188ms"},"msg":"","time":"2019-04-03T06:25:04.758Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"57ea0710-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"8025","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:25:04.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"24ea-3fblDC3ru6sqIqDyud4DMk0r1NM\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"132ms"},"msg":"","time":"2019-04-03T06:25:58.408Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7f491170-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"24fa0-16ikwjJ0hVO7ebWTSgkSsIozOME\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T06:27:04.384Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a25a4580-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"24fa0-16ikwjJ0hVO7ebWTSgkSsIozOME\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T06:28:03.230Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c15aac40-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"8283","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:25:58.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"25ec-DzQ0Gqsr5Uq8NsgxVqrPFyMMnWs\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"111ms"},"msg":"","time":"2019-04-03T06:28:55.286Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e89c6aa0-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.250.43","x-forwarded-proto":"https","x-real-ip":"3.81.250.43","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2527b-smr4PaA/gFA9OOKhP9VRL6EWmJ0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"66ms"},"msg":"","time":"2019-04-03T06:30:01.102Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fcd0b030-55d9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"9849","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:28:55.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2c0a-6TjKGQSEj6xgJAV3tD3BSMRmY74\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"131ms"},"msg":"","time":"2019-04-03T06:30:35.066Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"05c26c10-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"9894","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:30:34.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2c37-TdqUpG3v3E4Kl23zGlyDsz3W1NI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"261ms"},"msg":"","time":"2019-04-03T06:30:50.202Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"38ffa3e0-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10077","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:30:49.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2cee-9mHKgWXEZrLpmCpIRmW/ApkCcuM\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"208ms"},"msg":"","time":"2019-04-03T06:32:16.113Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4a276cc0-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2662e-Gcpl9fQIjw5KNjih3z2i6b6UYhk\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"71ms"},"msg":"","time":"2019-04-03T06:32:44.757Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"50dfda70-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10074","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　｜　优先级：-700\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:32:15.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2ceb-ht7LK8rI1i3/i4OmbsdBmNRhntY\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"185ms"},"msg":"","time":"2019-04-03T06:32:56.147Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6def46a0-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"265fb-W9BzruZkS6JT0sQ7QQSW67+BWHs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"62ms"},"msg":"","time":"2019-04-03T06:33:44.777Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ac7f82e0-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"265fb-W9BzruZkS6JT0sQ7QQSW67+BWHs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T06:35:29.738Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ae18e790-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10352","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:32:56.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2e01-h01d4UUwglELab+h4UuwWKp1hvM\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"232ms"},"msg":"","time":"2019-04-03T06:35:32.597Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d3d45410-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10443","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:35:32.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2e5c-zRqkrj8O1g6FwuxmL2OIaWJn4nw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"179ms"},"msg":"","time":"2019-04-03T06:36:35.847Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ee004f60-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"269f4-DA6dDRWbKqb/Y1Btdf3daeqqpkM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T06:37:19.626Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fa3883b0-55da-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10533","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定。\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:36:35.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2eb6-wxrbB6lGKCa6D65oBOirJs4ejuw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"172ms"},"msg":"","time":"2019-04-03T06:37:40.250Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0a920010-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10575","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:37:40.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2ee0-FM/7D8cr6yb5A+IVD8rCi7Tjc7s\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"253ms"},"msg":"","time":"2019-04-03T06:38:07.762Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"11021a20-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"26b80-o5pr4M7v1op4DlTroNTmZOHWYDM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T06:38:18.349Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"47fa3710-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"26b80-o5pr4M7v1op4DlTroNTmZOHWYDM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T06:39:50.578Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"58c3da60-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10799","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:38:07.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2fc0-rbYRe2m/ODhX72s8bjPQSuv9VE8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"160ms"},"msg":"","time":"2019-04-03T06:40:18.857Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5ddc0590-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10819","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:40:18.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"2fd4-TlNy7CLzAIT68XixlycbyFqByPU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"156ms"},"msg":"","time":"2019-04-03T06:40:27.400Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"82f95d50-55db-11e9-a41f-1dc48d552e2c","userId":null},"url":"/robots.txt","method":"GET","originalUrl":"/robots.txt","params":{},"headers":{"x-forwarded-for":"199.59.150.182","x-forwarded-proto":"https","x-real-ip":"199.59.150.182","host":"lancexlab.cn","connection":"close","x-b3-spanid":"360762f72e89bd3b","user-agent":"Twitterbot/1.0","x-b3-sampled":"false","x-b3-flags":"2","x-b3-parentspanid":"7b25adfb36d1426d","x-b3-traceid":"001948e6001aeaf7"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"text/plain","content-length":88,"etag":"\"f15f756fcf0b8854e4d47b134faf739c\"","cache-control":"public, max-age=3600","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T06:41:29.512Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"83134df0-55db-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904219-27-11.png","method":"GET","originalUrl":"/content/images/2019/04/201904219-27-11.png","params":{},"headers":{"x-forwarded-for":"199.59.150.182","x-forwarded-proto":"https","x-real-ip":"199.59.150.182","host":"lancexlab.cn","connection":"close","x-b3-spanid":"1480fbf102def1d9","user-agent":"Twitterbot/1.0","accept":"*/*","x-b3-sampled":"false","x-b3-flags":"2","x-b3-parentspanid":"7b25adfb36d1426d","accept-encoding":"gzip, deflate","x-b3-traceid":"001948e6001aeaf7"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Tue, 02 Apr 2019 11:27:22 GMT","etag":"W/\"eaa17-169ddcdbe41\"","content-type":"image/png","content-length":961047},"statusCode":200,"responseTime":"5ms"},"msg":"","time":"2019-04-03T06:41:29.686Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"83299510-55db-11e9-a41f-1dc48d552e2c","userId":null},"url":"/robots.txt","method":"GET","originalUrl":"/robots.txt","params":{},"headers":{"x-forwarded-for":"199.59.150.181","x-forwarded-proto":"https","x-real-ip":"199.59.150.181","host":"lancexlab.cn","connection":"close","x-b3-spanid":"b0eb0b00eeb6292c","user-agent":"Twitterbot/1.0","x-b3-sampled":"false","x-b3-flags":"2","x-b3-parentspanid":"941a411eb4b8fc45","x-b3-traceid":"001948e6001aeaf7"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"text/plain","content-length":88,"etag":"\"f15f756fcf0b8854e4d47b134faf739c\"","cache-control":"public, max-age=3600","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"3ms"},"msg":"","time":"2019-04-03T06:41:29.830Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"835204a0-55db-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904219-27-11.png","method":"GET","originalUrl":"/content/images/2019/04/201904219-27-11.png","params":{},"headers":{"x-forwarded-for":"199.59.150.181","x-forwarded-proto":"https","x-real-ip":"199.59.150.181","host":"lancexlab.cn","connection":"close","x-b3-spanid":"12a03ee6a53de775","user-agent":"Twitterbot/1.0","accept":"*/*","x-b3-sampled":"false","x-b3-flags":"2","x-b3-parentspanid":"941a411eb4b8fc45","accept-encoding":"gzip, deflate","x-b3-traceid":"001948e6001aeaf7"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Tue, 02 Apr 2019 11:27:22 GMT","etag":"W/\"eaa17-169ddcdbe41\"","content-type":"image/png","content-length":961047},"statusCode":200,"responseTime":"9ms"},"msg":"","time":"2019-04-03T06:41:30.101Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a5adf270-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"10985","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:40:27.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"307a-BH5mM2fQdDb8FOBW6P1Q22f73wk\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"138ms"},"msg":"","time":"2019-04-03T06:42:27.876Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b196a730-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"271cd-b80lGbI15GPQKS69djGfHiokl+E\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T06:42:47.778Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b7d8ac60-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"35.171.22.50","x-forwarded-proto":"https","x-real-ip":"35.171.22.50","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"271cd-b80lGbI15GPQKS69djGfHiokl+E\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T06:42:58.269Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fc45c360-55db-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"271cd-b80lGbI15GPQKS69djGfHiokl+E\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T06:44:53.061Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"65513e20-55dc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"271cd-b80lGbI15GPQKS69djGfHiokl+E\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T06:47:49.301Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6c586810-55dc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"271cd-b80lGbI15GPQKS69djGfHiokl+E\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T06:48:01.092Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a678c710-55dc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.227.194.138","x-forwarded-proto":"https","x-real-ip":"34.227.194.138","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"271cd-b80lGbI15GPQKS69djGfHiokl+E\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"149ms"},"msg":"","time":"2019-04-03T06:49:38.718Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d3668c30-55dc-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"11075","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:42:27.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"30d4-QaRLGOSAldg+kLGB9UI0dshv0OY\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"181ms"},"msg":"","time":"2019-04-03T06:50:54.123Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"18a9b7e0-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"272c1-lo2o62BUOowhGxhhJ55zIrK82bQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T06:52:50.201Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1c61b6d0-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"272c1-lo2o62BUOowhGxhhJ55zIrK82bQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T06:52:56.437Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"36311330-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"11306","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚。\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:50:54.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"31bb-blJr/vss0nKHbI56fHeZklubBgc\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"144ms"},"msg":"","time":"2019-04-03T06:53:39.830Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3f1adfd0-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"84213","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryMl8hj8fkEV0M8BA1","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-9H8pq4H1XZNcc6Df6Kb2AL1zV+M\""},"statusCode":201,"responseTime":"129ms"},"msg":"","time":"2019-04-03T06:53:54.768Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6a0310f0-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"11529","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后。\"]]],[10,19],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:53:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3286-axJ0S9Y0dGcWCrKCwz5wWkoWtLo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"160ms"},"msg":"","time":"2019-04-03T06:55:06.786Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"76932940-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"277fb-r32nNs+sLusNTvZ7Qr/EUkaFiPs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T06:55:27.748Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9c19ca20-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"11639","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:55:06.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"32f4-Pk3A+eZ+P16pcmmcRX9gDbzJfFs\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"204ms"},"msg":"","time":"2019-04-03T06:56:30.866Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ba836f20-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27946-cpvkn3j77iqtyCaxTb8hJl8jOVI\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T06:57:21.737Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c534dc60-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"11755","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:56:30.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3368-czRqNKPfX2TyD6mtzvjtk0piE0w\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"140ms"},"msg":"","time":"2019-04-03T06:57:39.765Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c7572020-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27b02-R+VlrhOLXhrnmc48bMFkREkfyD4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"132ms"},"msg":"","time":"2019-04-03T06:57:43.336Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f93d5370-55dd-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"11703","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:57:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3334-UwC8qJtcbh7ssw/ewWVwESt30Iw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"156ms"},"msg":"","time":"2019-04-03T06:59:07.078Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0c5ad1d0-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"11762","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:59:06.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"336f-KPJmyqiuxpTLyFM+CLtiLcOAmWQ\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"182ms"},"msg":"","time":"2019-04-03T06:59:39.174Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"285ac9d0-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27afc-4+yLMxQ/w5/v9vWcjPGzjGJV+xQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T07:00:26.014Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"40bcb380-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"49471","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundarytRYr0DM8mt3zAfih","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-ThjkZeW9Q0hRtPxR/Q9FRV4zQPE\""},"statusCode":201,"responseTime":"82ms"},"msg":"","time":"2019-04-03T07:01:06.956Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6e7039a0-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27afc-4+yLMxQ/w5/v9vWcjPGzjGJV+xQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T07:02:23.597Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"705acb90-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27afc-4+yLMxQ/w5/v9vWcjPGzjGJV+xQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T07:02:26.807Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c06d9ae0-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"12118","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T06:59:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"34bf-I2a0Sd9dOEbyc6NJz2Ke/a+pZ4w\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"150ms"},"msg":"","time":"2019-04-03T07:04:41.255Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c1c40320-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27ed9-rujeCb1CvtLz/pxX9U0fSP06EVo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T07:04:43.390Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d7102150-55de-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"12128","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:04:41.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"34c9-S59KYZLDm+ToKfxBOpu7qyiTqoc\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"175ms"},"msg":"","time":"2019-04-03T07:05:19.256Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0dfad0c0-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27f40-zBeWXZ+rD5aCqfnyKerW/UFcvNw\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T07:06:51.259Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1a9c9c50-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27f40-zBeWXZ+rD5aCqfnyKerW/UFcvNw\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T07:07:12.449Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4ca96a70-55df-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/","params":{},"headers":{"x-forwarded-for":"222.180.149.236","x-forwarded-proto":"http","x-real-ip":"222.180.149.236","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","accept-encoding":"","accept-language":"zh-CN,zh;q=0.8","cache-control":"max-age=0"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=31536000","location":"https://lancexlab.cn/","vary":"Accept, Accept-Encoding","content-type":"text/html; charset=utf-8","content-length":"98"},"statusCode":301,"responseTime":"1ms"},"msg":"","time":"2019-04-03T07:08:36.378Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6c1b0990-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.101.131","x-forwarded-proto":"https","x-real-ip":"54.196.101.131","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"27f40-zBeWXZ+rD5aCqfnyKerW/UFcvNw\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T07:09:29.173Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"720a33d0-55df-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904314-48-44.png","method":"GET","originalUrl":"/content/images/2019/04/201904314-48-44.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 06:53:54 GMT","etag":"W/\"10854-169e1f9bec6\"","content-type":"image/png","content-length":67668},"statusCode":200,"responseTime":"3ms"},"msg":"","time":"2019-04-03T07:09:39.089Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"720a81f0-55df-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-00-56.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-00-56.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:01:06 GMT","etag":"W/\"9c68-169e2005702\"","content-type":"image/png","content-length":40040},"statusCode":200,"responseTime":"3ms"},"msg":"","time":"2019-04-03T07:09:39.091Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"87d87a50-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"12702","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:05:19.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3707-0s1eh2PRcFzuYVybpg6LBxuBgnw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"245ms"},"msg":"","time":"2019-04-03T07:10:15.919Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b6bfec90-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2854f-ZnUj/RUeHkjZaQuRZuWbgWY6fF8\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T07:11:34.425Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c31e6d90-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"12886","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:10:15.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"37bf-BXuO65q9man28OG1d/Ldl+JIg7A\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"226ms"},"msg":"","time":"2019-04-03T07:11:55.343Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ccd4b1f0-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"287a4-qwScvv9JEkOailA8rwu6dydLI/0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"64ms"},"msg":"","time":"2019-04-03T07:12:11.472Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f28ee5f0-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"12904","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:11:55.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"37d1-7KsHFMREo72Gp63ny7l46ZGrX8M\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"188ms"},"msg":"","time":"2019-04-03T07:13:14.895Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f9bcaab0-55df-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"139284","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryKdMuMGYGqBq1hQ6q","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-xzJHR53Ds97Eqmm6HA304aDhucs\""},"statusCode":201,"responseTime":"153ms"},"msg":"","time":"2019-04-03T07:13:26.902Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"09552100-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13022","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:13:14.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3833-SIBmh7BdbaUxPvO9fMOuNlI6gHI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"209ms"},"msg":"","time":"2019-04-03T07:13:53.125Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0ab77020-55e0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"7563-ATfkXqgv1pZO1NCI+l2fXFLsWUI\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"8a31-pkVtEhvKJKlqa/EHjW0Bis3xdJ0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"185ms"},"msg":"","time":"2019-04-03T07:13:55.423Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0ae0f120-55e0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-12-54.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-12-54.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:13:26 GMT","etag":"W/\"1bbef-169e20ba16e\"","content-type":"image/png","content-length":113647},"statusCode":200,"responseTime":"3ms"},"msg":"","time":"2019-04-03T07:13:55.510Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0af9f760-55e0-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T07:13:55.673Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2639d3b0-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13016","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:13:52.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"382d-nq7Gqgh1e8kdojkJzMCF9YYYKdU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"168ms"},"msg":"","time":"2019-04-03T07:14:41.558Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3618c8e0-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2894c-SpbXpsqtc2VlejBYip94cVUZ/Ms\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T07:15:08.061Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5ff50840-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2894c-SpbXpsqtc2VlejBYip94cVUZ/Ms\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"76ms"},"msg":"","time":"2019-04-03T07:16:18.321Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7af591a0-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.66.188","x-forwarded-proto":"https","x-real-ip":"54.196.66.188","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2894c-SpbXpsqtc2VlejBYip94cVUZ/Ms\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T07:17:03.601Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9fd9d800-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13364","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:14:41.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T06:18:04.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T06:18:04.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3989-6PwfkC9M2GhXyar0++uoDxC+z3c\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"146ms"},"msg":"","time":"2019-04-03T07:18:05.589Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a11d2d70-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13367","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:18:05.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"398c-RtyDnuJoMoOOPUPMtbmTiICXtmo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"141ms"},"msg":"","time":"2019-04-03T07:18:07.704Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ab8e8470-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13395","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:18:07.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"39a8-R1iGm9SE4rhXS9uexaRpZsdLA2U\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"173ms"},"msg":"","time":"2019-04-03T07:18:25.256Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b2144960-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13415","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:18:25.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"39bc-Pug9UVpO6NxGxpZBFmgeta9z+rM\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"150ms"},"msg":"","time":"2019-04-03T07:18:36.177Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"dd2a4140-55e0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.162.78.82","x-forwarded-proto":"https","x-real-ip":"54.162.78.82","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28e30-tMG6GrJEHURGJEz5RM6yNBuEiGc\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"67ms"},"msg":"","time":"2019-04-03T07:19:48.383Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"03e4f550-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28e30-tMG6GrJEHURGJEz5RM6yNBuEiGc\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T07:20:53.328Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1ee99d60-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28e30-tMG6GrJEHURGJEz5RM6yNBuEiGc\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"154ms"},"msg":"","time":"2019-04-03T07:21:38.777Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4edd2870-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13400","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:18:36.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"39ad-ulKaZc++U84mx1mhp30X8Wd+0xE\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"165ms"},"msg":"","time":"2019-04-03T07:22:59.233Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7c17ae00-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28de8-ry8l3d+RYrgu5ZAB7IrMgiWVEX0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"72ms"},"msg":"","time":"2019-04-03T07:24:15.018Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"82de7390-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"128257","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryOKk4rxFfPLKH87oA","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-HvCOggxQV+NNU5AtpdrQfc/EUFE\""},"statusCode":201,"responseTime":"143ms"},"msg":"","time":"2019-04-03T07:24:26.458Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"843c07c0-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13511","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-24-15.png\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[]],[10,26],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:22:59.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3a08-yMxmduZx2fWzZicbnvJsz2ppX0M\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"134ms"},"msg":"","time":"2019-04-03T07:24:28.742Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9fbc9690-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28eff-g25FQv+tfHXPoP0TXgxeTtObEgQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T07:25:14.796Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"bc5b8db0-55e1-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.162.78.82","x-forwarded-proto":"https","x-real-ip":"54.162.78.82","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28eff-g25FQv+tfHXPoP0TXgxeTtObEgQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"77ms"},"msg":"","time":"2019-04-03T07:26:02.841Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"27a00880-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.162.78.82","x-forwarded-proto":"https","x-real-ip":"54.162.78.82","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28eff-g25FQv+tfHXPoP0TXgxeTtObEgQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"77ms"},"msg":"","time":"2019-04-03T07:29:02.806Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3d929fe0-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"255802","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundaryraoniyKDFTBzRK5M","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-zDIW3iRI6MrPO46Y9NMH+BZpiNY\""},"statusCode":201,"responseTime":"262ms"},"msg":"","time":"2019-04-03T07:29:39.814Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"55556360-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13615","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个\"]]],[10,26],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:24:28.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3a70-paiCYMz+1vsDP6zx3v+POJ5bGwQ\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"155ms"},"msg":"","time":"2019-04-03T07:30:19.572Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"62d16250-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"28fe8-apoy7nf7Jfn4AkjKHKQ7QlymUXA\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T07:30:42.088Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"72783080-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13687","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，\"]]],[10,26],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:30:19.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3ab8-KHhKktrQMOLEhJTMFh2bU8oCBC4\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"217ms"},"msg":"","time":"2019-04-03T07:31:08.517Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"84179a60-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"290c0-cJUy1IWfnt6YbR9G9p6Yvjw82IM\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T07:31:37.922Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9f980220-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"13799","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，主要功能是将服务id转换至服务的真实地址进行调用，替换掉request的path到服务地址。\"]]],[10,26],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:31:08.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3b28-yXjMs0zqRtOLK2w8Rlu+KDdRF30\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"215ms"},"msg":"","time":"2019-04-03T07:32:24.222Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"cee1dfb0-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29210-fmjyXlctY7HtxWXf2uQgrgubiwo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"64ms"},"msg":"","time":"2019-04-03T07:33:43.404Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ecde6b00-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14024","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，主要功能是将服务id转换至服务的真实地址进行调用，替换掉request的path到服务地址。将1b://{serviceId}换成真实的path；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:32:24.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3c09-qXqlQqIBWg65whrnOJ2bGYI/Ye8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"228ms"},"msg":"","time":"2019-04-03T07:34:33.883Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f15e4dd0-55e2-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14031","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，主要功能是将服务id转换至服务的真实地址进行调用，替换掉request的path到服务地址。将1b://{serviceId}换成真实的path；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:34:33.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3c10-FTmD5qBW7arbF4oxXKvvKqoxrK0\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"234ms"},"msg":"","time":"2019-04-03T07:34:41.434Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"23c263b0-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.66.188","x-forwarded-proto":"https","x-real-ip":"54.196.66.188","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29512-V7iBkG4EJ2sViKTG/nvvi8LBCvQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T07:36:05.798Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"35aa2130-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29512-V7iBkG4EJ2sViKTG/nvvi8LBCvQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T07:36:35.828Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4893e560-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14193","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；主要功能是将请求转换至服务的真实地址进行调用，替换掉request的path到服务地址。将1b://{serviceId}换成真实的path；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:34:41.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3cb2-lXL/R00inPIgwwOOSep8DMc/42I\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"159ms"},"msg":"","time":"2019-04-03T07:37:07.672Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"666d5850-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.66.188","x-forwarded-proto":"https","x-real-ip":"54.196.66.188","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"296f8-FyE3hguI8Nb43+VvvXdDbvrEVdo\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T07:37:57.645Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7f40ef90-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14112","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务1b://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:37:07.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3c61-+eH4l/0n7CtwMq01SrKuF8Jd0Rs\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"185ms"},"msg":"","time":"2019-04-03T07:38:39.429Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"82ef5190-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14112","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务1b://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:38:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"3c61-+eH4l/0n7CtwMq01SrKuF8Jd0Rs\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"93ms"},"msg":"","time":"2019-04-03T07:38:45.512Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"92f1d450-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14182","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务1b://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:38:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3ca7-Hrw7LdJASkFrVZhLa0df4Jle3vg\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"133ms"},"msg":"","time":"2019-04-03T07:39:12.413Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b1056a10-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14195","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:39:12.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3cb4-NskZz7pOKVClbG4Tl79IEdIMZqw\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"191ms"},"msg":"","time":"2019-04-03T07:40:02.933Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c70d3720-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.162.78.82","x-forwarded-proto":"https","x-real-ip":"54.162.78.82","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"296d5-DZEEkSBgDhC+YqALm7Vl/y+9d2o\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"82ms"},"msg":"","time":"2019-04-03T07:40:39.781Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ea9a51f0-55e3-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"296d5-DZEEkSBgDhC+YqALm7Vl/y+9d2o\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T07:41:39.397Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2026f800-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.204.197.164","x-forwarded-proto":"https","x-real-ip":"18.204.197.164","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"296d5-DZEEkSBgDhC+YqALm7Vl/y+9d2o\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"44ms"},"msg":"","time":"2019-04-03T07:43:09.230Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2b684930-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14377","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，\"]]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:40:02.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3d6a-VGS0l4D6OTKnzS4a4YbBpxZkO1M\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"121ms"},"msg":"","time":"2019-04-03T07:43:28.190Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5ed591b0-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14520","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，\"]]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:43:28.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3df9-AYPpbfYZeMsNT++BVhRbLGuFXtA\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"237ms"},"msg":"","time":"2019-04-03T07:44:54.588Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"718d2250-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14571","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance，\"]]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:44:54.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3e2c-sP4mkmlu3lItqo+R5n8ZpMf1PjU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"135ms"},"msg":"","time":"2019-04-03T07:45:25.887Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8012f020-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14613","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），\"]]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:45:25.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3e56-JCShC/8F0YKr5Qvy0qUmhOP5e8U\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"148ms"},"msg":"","time":"2019-04-03T07:45:50.265Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"88c53200-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29ba2-NIegBz03b8dvllXBwbUCrSYxeW8\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"75ms"},"msg":"","time":"2019-04-03T07:46:04.780Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8d0106f0-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.27.40.226","x-forwarded-proto":"https","x-real-ip":"100.27.40.226","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29ba2-NIegBz03b8dvllXBwbUCrSYxeW8\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T07:46:11.870Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ac076120-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"216035","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundary7DZHmFYjejYKSC4L","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-GRgr7WLzXQ2g2ffYYGnRfLoWnW8\""},"statusCode":201,"responseTime":"237ms"},"msg":"","time":"2019-04-03T07:47:04.096Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b1cd3170-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14832","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\"]],[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:45:50.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3f1d-tliL/9TiAzIGLy/+9M6U7tLAShg\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"143ms"},"msg":"","time":"2019-04-03T07:47:13.689Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c991c9b0-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.27.40.226","x-forwarded-proto":"https","x-real-ip":"100.27.40.226","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29e4e-+guJMHYBIYEL5P3rb83z1xcXJQg\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T07:47:53.470Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"de5e0980-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14864","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:47:13.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3f3d-NaRQfEdBKRKNyfu5FM0LrGHmDSI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"228ms"},"msg":"","time":"2019-04-03T07:48:28.545Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e2b2bda0-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14871","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:48:28.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3f44-Sdoy0spSOMCSIssAWzjoOd5O6vs\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"178ms"},"msg":"","time":"2019-04-03T07:48:35.759Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f4117500-55e4-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14877","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[]],[1,\"p\",[]],[1,\"p\",[]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\"]],[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:48:35.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3f4a-DH97KdbvOcpOF4gVx67U5UzL3sI\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"217ms"},"msg":"","time":"2019-04-03T07:49:04.939Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"44662f50-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.27.40.226","x-forwarded-proto":"https","x-real-ip":"100.27.40.226","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29ee8-36vXfVlbPINgOizM3Fr+tbCM1aQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"73ms"},"msg":"","time":"2019-04-03T07:51:19.567Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"53295440-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29ee8-36vXfVlbPINgOizM3Fr+tbCM1aQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T07:51:44.315Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6c2708c0-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.27.40.226","x-forwarded-proto":"https","x-real-ip":"100.27.40.226","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"29ee8-36vXfVlbPINgOizM3Fr+tbCM1aQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T07:52:26.250Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"81302a80-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"160187","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundarysILlzGOrD4LA398c","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-O5GUtXqwU/IVqPKYCElmklgBHuY\""},"statusCode":201,"responseTime":"225ms"},"msg":"","time":"2019-04-03T07:53:01.707Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"971c5940-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14945","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[]],[10,31],[1,\"p\",[]],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[3,\"ul\",[[[0,[],0,\"org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"]]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:49:04.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3f7a-g5wjZlRx/2C8BonG+6+j2xSjU8o\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"167ms"},"msg":"","time":"2019-04-03T07:53:38.430Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9aaf1cf0-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14847","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[]],[10,31],[1,\"p\",[]],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:53:38.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3f18-jMoo2d6bxwpH6e6WhzzLu3lvHc8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"214ms"},"msg":"","time":"2019-04-03T07:53:44.472Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9f31bee0-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"14854","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:53:44.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3f1f-y+cVuPaTW2mLw5nM5f7MQ4CyQ/I\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"346ms"},"msg":"","time":"2019-04-03T07:53:52.173Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ee6c7db0-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15074","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:53:51.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"3ffb-jAbabdanl5jROCVStNnfbrdjMVY\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"190ms"},"msg":"","time":"2019-04-03T07:56:04.943Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"fc6f38d0-55e5-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.27.40.226","x-forwarded-proto":"https","x-real-ip":"100.27.40.226","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2a15e-3pD+FVU+R6J2RETVYMrJeailFxQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"77ms"},"msg":"","time":"2019-04-03T07:56:28.332Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"07cf0e80-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2a15e-3pD+FVU+R6J2RETVYMrJeailFxQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T07:56:47.380Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0a367190-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2a15e-3pD+FVU+R6J2RETVYMrJeailFxQ\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T07:56:51.430Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0b8efcb0-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15126","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:56:04.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"402f-3MpIo+/oajnBG39H6mifATWk+JQ\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"188ms"},"msg":"","time":"2019-04-03T07:56:53.818Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0dec74b0-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15126","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:56:53.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"402f-3MpIo+/oajnBG39H6mifATWk+JQ\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"119ms"},"msg":"","time":"2019-04-03T07:56:57.717Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0f862780-55e6-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"8a31-pkVtEhvKJKlqa/EHjW0Bis3xdJ0\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"938d-7upCMlIGpoCqiMZgH9ypwaR/Uh4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"87ms"},"msg":"","time":"2019-04-03T07:57:00.368Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0f9da721-55e6-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-41-52.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-41-52.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:47:04 GMT","etag":"W/\"2cb0f-169e22a6916\"","content-type":"image/png","content-length":183055},"statusCode":200,"responseTime":"4ms"},"msg":"","time":"2019-04-03T07:57:00.439Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0f9da720-55e6-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-29-14.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-29-14.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:29:39 GMT","etag":"W/\"33a8b-169e21a79de\"","content-type":"image/png","content-length":211595},"statusCode":200,"responseTime":"6ms"},"msg":"","time":"2019-04-03T07:57:00.441Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0f9edfa0-55e6-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-52-49.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-52-49.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:53:01 GMT","etag":"W/\"1f940-169e22fde02\"","content-type":"image/png","content-length":129344},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T07:57:00.445Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1195cda0-55e6-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"96ms"},"msg":"","time":"2019-04-03T07:57:03.844Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"46e1e840-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/images/upload/","method":"POST","originalUrl":"/ghost/api/v2/admin/images/upload/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"67003","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"multipart/form-data; boundary=----WebKitFormBoundarySbxp5pJ7xYHXDCzF","accept":"text/plain, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"purpose":"image"},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","content-length":"97","etag":"W/\"61-qErqrSlQNIacOlsZgexJ9eefI7M\""},"statusCode":201,"responseTime":"87ms"},"msg":"","time":"2019-04-03T07:58:33.244Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"7bea4320-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15389","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T07:56:53.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"4122-RVU0M1Rt/n6yoe5QcrAABXzrewE\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"173ms"},"msg":"","time":"2019-04-03T08:00:02.307Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"8544d2f0-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15409","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:00:02.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"4136-Am/NhLuHjxgPrza+C84PvrM94/o\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"221ms"},"msg":"","time":"2019-04-03T08:00:18.048Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"886c9fd0-55e6-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-58-19.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-58-19.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:58:33 GMT","etag":"W/\"d28b-169e234ed16\"","content-type":"image/png","content-length":53899},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:00:23.121Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9056afb0-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15437","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:00:17.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"4152-4Frc79p/wk6NKw8M9KEBkKhLu18\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"155ms"},"msg":"","time":"2019-04-03T08:00:36.553Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ad206050-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2a5a1-A2JyzP3l895RyZ9yjGOC21qGUl4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T08:01:24.753Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b94ea990-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.27.40.226","x-forwarded-proto":"https","x-real-ip":"100.27.40.226","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2a5a1-A2JyzP3l895RyZ9yjGOC21qGUl4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"71ms"},"msg":"","time":"2019-04-03T08:01:45.201Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"c83dc080-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.66.188","x-forwarded-proto":"https","x-real-ip":"54.196.66.188","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2a5a1-A2JyzP3l895RyZ9yjGOC21qGUl4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"78ms"},"msg":"","time":"2019-04-03T08:02:10.263Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ec7af170-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15707","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:00:36.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"4260-okdOwsqDlpQjSWQb0ZV5YFO0KXU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"158ms"},"msg":"","time":"2019-04-03T08:03:11.144Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ed7a6010-55e6-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15720","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:03:11.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"426d-Wt5W+8inSc/6zYFk0/jaymiJrnQ\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"209ms"},"msg":"","time":"2019-04-03T08:03:12.869Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2015d9a0-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"15852","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[[0,[],0,\"整个filter的调用通过Ordered接口捆绑成一个链式结构，并且通过reactor流式编程将代码精简，\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:03:12.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"42f1-DyL9GQnnef3rvcv2S5hvxHS1+gU\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"224ms"},"msg":"","time":"2019-04-03T08:04:37.791Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4f383200-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"16029","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[[0,[],0,\"整个filter的调用通过Ordered接口捆绑成一个链式结构，并且通过reactor流式编程将代码精简，这是一个非常优秀的思想，如果在自己的服务当中采用此编码模型的话，会使得代码清晰很多，感兴趣的读者可以参考学习reactor-core。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:04:37.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"43a2-8LR9C8zynRs0c0Fc5g3N+EbX/oo\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"208ms"},"msg":"","time":"2019-04-03T08:05:56.852Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"53f67d60-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"100.27.40.226","x-forwarded-proto":"https","x-real-ip":"100.27.40.226","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2ac3d-W7EV4BQEcci4FaR5T1ejyx0U4ws\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"72ms"},"msg":"","time":"2019-04-03T08:06:04.671Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"61139370-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2ac3d-W7EV4BQEcci4FaR5T1ejyx0U4ws\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"66ms"},"msg":"","time":"2019-04-03T08:06:26.666Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"68ab8bb0-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"16134","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"],[\"a\",[\"href\",\"https://github.com/reactor/reactor-core\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[[0,[],0,\"整个filter的调用通过Ordered接口捆绑成一个链式结构，并且通过reactor流式编程将代码精简，这是一个非常优秀的思想，如果在自己的服务当中采用此编码模型的话，会使得代码清晰很多，感兴趣的读者可以参考学习\"],[0,[4],1,\"reactor-core\"],[0,[],0,\"。\"]]],[1,\"p\",[]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:05:56.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"440b-g3lkvWtleE9IR+YYPUuzzlA0E3g\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"236ms"},"msg":"","time":"2019-04-03T08:06:39.579Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9220f2f0-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.235.39","x-forwarded-proto":"https","x-real-ip":"18.234.235.39","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2ad0c-wKlleWAwqaU47i7plYcBvhnVhnU\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"56ms"},"msg":"","time":"2019-04-03T08:07:48.952Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"bfa70070-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"16415","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"],[\"a\",[\"href\",\"https://github.com/reactor/reactor-core\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[[0,[],0,\"整个filter的调用通过Ordered接口捆绑成一个链式结构，并且通过reactor流式编程将代码精简，这是一个非常优秀的思想，如果在自己的服务当中采用此编码模型的话，会使得代码清晰很多，感兴趣的读者可以参考学习\"],[0,[4],1,\"reactor-core\"],[0,[],0,\"。\"]]],[1,\"p\",[[0,[],0,\"本文主要分析了gateway的GlobalFilter的源码实现，对于enhance-gateway实现的GlobalFilter只是提及，这个是一种前后对应的设计思想，并不是很完美，计划在后续通过一篇独立的文章探讨自己的思想，并进行优化。\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:06:39.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"4524-Qvyn6TkvC3Uhzkqn7mSJnOSS+7U\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"174ms"},"msg":"","time":"2019-04-03T08:09:05.449Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"df6d2830-55e7-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"16570","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"https://lancexlab.cn/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"https://lancexlab.cn/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"],[\"a\",[\"href\",\"https://github.com/reactor/reactor-core\"]],[\"a\",[\"href\",\"https://github.com/IBlogLab/enhance-gateway\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[[0,[],0,\"整个filter的调用通过Ordered接口捆绑成一个链式结构，并且通过reactor流式编程将代码精简，这是一个非常优秀的思想，如果在自己的服务当中采用此编码模型的话，会使得代码清晰很多，感兴趣的读者可以参考学习\"],[0,[4],1,\"reactor-core\"],[0,[],0,\"。\"]]],[1,\"p\",[[0,[],0,\"本文主要分析了gateway的GlobalFilter的源码实现，对于enhance-gateway实现的GlobalFilter只是提及，这个是一种前后对应的设计思想，并不是很完美，计划在后续通过一篇独立的文章探讨自己的思想，并进行优化。\"]]],[1,\"p\",[[0,[],0,\"注：\"],[0,[5],1,\"enhance-gateway\"],[0,[],0,\"参考地址\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:09:05.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T07:18:05.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T07:18:05.000Z","count":{"posts":3},"facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"45bf-cb11iThG7U6ucfgW+zMTuTBqM2g\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"242ms"},"msg":"","time":"2019-04-03T08:09:58.825Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e10f8d90-55e7-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"938d-7upCMlIGpoCqiMZgH9ypwaR/Uh4\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"9904-LZpZp6R9BMEFIwPTEjzR9GNTz7g\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"115ms"},"msg":"","time":"2019-04-03T08:10:01.438Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e1443220-55e7-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"3ms"},"msg":"","time":"2019-04-03T08:10:01.671Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"02fba290-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b19a-F3d+AtUQS4lUtzOBfjySadzRY7w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T08:10:58.284Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5b1383d0-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b19a-F3d+AtUQS4lUtzOBfjySadzRY7w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T08:13:26.084Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f374ea0-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-18-12.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-18-12.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:18:28 GMT","etag":"W/\"8401-169e0fd9497\"","content-type":"image/png","content-length":33793},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:13:59.822Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f3a0dc0-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-24-39.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-24-39.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:24:49 GMT","etag":"W/\"83e5-169e13a53ac\"","content-type":"image/png","content-length":33765},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:13:59.838Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f3b1f30-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-47-50.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-47-50.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:48:00 GMT","etag":"W/\"9898-169e1189d1e\"","content-type":"image/png","content-length":39064},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:13:59.845Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f3c57b0-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-00-56.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-00-56.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:01:06 GMT","etag":"W/\"9c68-169e2005702\"","content-type":"image/png","content-length":40040},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:13:59.853Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f3cf3f0-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-41-52.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-41-52.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:47:04 GMT","etag":"W/\"2cb0f-169e22a6916\"","content-type":"image/png","content-length":183055},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:13:59.857Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f41fd05-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-57-06.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-57-06.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:57:21 GMT","etag":"W/\"b527-169e1581a91\"","content-type":"image/png","content-length":46375},"statusCode":200,"responseTime":"6ms"},"msg":"","time":"2019-04-03T08:13:59.895Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f41fd01-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904309-54-01.png","method":"GET","originalUrl":"/content/images/2019/04/201904309-54-01.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 01:55:16 GMT","etag":"W/\"18553-169e0e856ca\"","content-type":"image/png","content-length":99667},"statusCode":200,"responseTime":"9ms"},"msg":"","time":"2019-04-03T08:13:59.898Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f41fd03-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904314-48-44.png","method":"GET","originalUrl":"/content/images/2019/04/201904314-48-44.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 06:53:54 GMT","etag":"W/\"10854-169e1f9bec6\"","content-type":"image/png","content-length":67668},"statusCode":200,"responseTime":"10ms"},"msg":"","time":"2019-04-03T08:13:59.899Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f422410-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-58-19.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-58-19.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:58:33 GMT","etag":"W/\"d28b-169e234ed16\"","content-type":"image/png","content-length":53899},"statusCode":200,"responseTime":"11ms"},"msg":"","time":"2019-04-03T08:13:59.900Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f41fd02-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-52-49.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-52-49.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:53:01 GMT","etag":"W/\"1f940-169e22fde02\"","content-type":"image/png","content-length":129344},"statusCode":200,"responseTime":"13ms"},"msg":"","time":"2019-04-03T08:13:59.902Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f41fd00-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-12-54.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-12-54.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:13:26 GMT","etag":"W/\"1bbef-169e20ba16e\"","content-type":"image/png","content-length":113647},"statusCode":200,"responseTime":"14ms"},"msg":"","time":"2019-04-03T08:13:59.903Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6f41fd04-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-29-14.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-29-14.png","params":{},"headers":{"x-forwarded-for":"123.59.143.212","x-forwarded-proto":"https","x-real-ip":"123.59.143.212","host":"lancexlab.cn","connection":"close","accept-encoding":"identity","referer":"https://lancexlab.cn/","user-agent":"Mozilla/5.0 (Linux; Android 4.4.4; HM 1S Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036555 Safari/537.36 MicroMessenger/6.3.23.840 NetType/WIFI Language/zh_CN"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:29:39 GMT","etag":"W/\"33a8b-169e21a79de\"","content-type":"image/png","content-length":211595},"statusCode":200,"responseTime":"15ms"},"msg":"","time":"2019-04-03T08:13:59.904Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a057e800-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b19a-F3d+AtUQS4lUtzOBfjySadzRY7w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T08:15:22.295Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3853320-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","upgrade-insecure-requests":"1","x-maimai-reqid":"8bbb7791b43f428a86be700f4c2c002d","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"9904-LZpZp6R9BMEFIwPTEjzR9GNTz7g\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"73ms"},"msg":"","time":"2019-04-03T08:15:27.645Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3b34800-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/assets/built/screen.css?v=df61ece7fa","method":"GET","originalUrl":"/assets/built/screen.css?v=df61ece7fa","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"text/css,*/*;q=0.1","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{"v":"df61ece7fa"}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"9e68-7438674ba0\"","content-type":"text/css; charset=UTF-8","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T08:15:27.922Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3ee2e20-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/assets/built/jquery.fitvids.js?v=df61ece7fa","method":"GET","originalUrl":"/assets/built/jquery.fitvids.js?v=df61ece7fa","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"*/*","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{"v":"df61ece7fa"}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"777-7438674ba0\"","content-type":"application/javascript; charset=UTF-8","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"14ms"},"msg":"","time":"2019-04-03T08:15:28.274Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3f951b0-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/size/w1000/2019/04/201904219-27-11.png","method":"GET","originalUrl":"/content/images/size/w1000/2019/04/201904219-27-11.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Tue, 02 Apr 2019 11:30:37 GMT","etag":"W/\"eaa17-169ddd0b929\"","content-type":"image/png","content-length":961047},"statusCode":200,"responseTime":"10ms"},"msg":"","time":"2019-04-03T08:15:28.342Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3fa6320-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904309-54-01.png","method":"GET","originalUrl":"/content/images/2019/04/201904309-54-01.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 01:55:16 GMT","etag":"W/\"18553-169e0e856ca\"","content-type":"image/png","content-length":99667},"statusCode":200,"responseTime":"5ms"},"msg":"","time":"2019-04-03T08:15:28.344Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3f86750-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/03/F026AB14-863E-47DC-9E79-7E98B24EC37A.png","method":"GET","originalUrl":"/content/images/2019/03/F026AB14-863E-47DC-9E79-7E98B24EC37A.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Mon, 25 Mar 2019 11:01:21 GMT","etag":"W/\"1ccd-169b4830c20\"","content-type":"image/png","content-length":7373},"statusCode":200,"responseTime":"20ms"},"msg":"","time":"2019-04-03T08:15:28.346Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3fecff1-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-18-12.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-18-12.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:18:28 GMT","etag":"W/\"8401-169e0fd9497\"","content-type":"image/png","content-length":33793},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:15:28.370Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3fecff0-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-47-50.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-47-50.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:48:00 GMT","etag":"W/\"9898-169e1189d1e\"","content-type":"image/png","content-length":39064},"statusCode":200,"responseTime":"4ms"},"msg":"","time":"2019-04-03T08:15:28.372Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a3ffe160-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/spring_cloud_gateway_diagram.png","method":"GET","originalUrl":"/content/images/2019/04/spring_cloud_gateway_diagram.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Mon, 01 Apr 2019 09:13:30 GMT","etag":"W/\"4138-169d82cd496\"","content-type":"image/png","content-length":16696},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:15:28.376Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a41a2020-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-24-39.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-24-39.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:24:49 GMT","etag":"W/\"83e5-169e13a53ac\"","content-type":"image/png","content-length":33765},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:15:28.549Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a41da290-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-57-06.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-57-06.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"image/png,image/svg+xml,image/*;q=0.8,video/*;q=0.8,*/*;q=0.5","user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/16D57/{iPhone10,1} [iOS 12.1.4]/MaiMai 5.0.4(5.0.4.4)","accept-language":"zh-cn","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"br, gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:57:21 GMT","etag":"W/\"b527-169e1581a91\"","content-type":"image/png","content-length":46375},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:15:28.572Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"b3de3a50-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.203.242.124","x-forwarded-proto":"https","x-real-ip":"34.203.242.124","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b19a-F3d+AtUQS4lUtzOBfjySadzRY7w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"64ms"},"msg":"","time":"2019-04-03T08:15:55.062Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e449b480-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","method":"GET","originalUrl":"/ghost/api/v2/admin/posts/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"30","page":"1","filter":"status:[draft,scheduled,published]"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"17473-zo7u1CUc+MUaZeRpbCH7Zy75tq0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T08:17:16.289Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e68d14d0-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/","method":"GET","originalUrl":"/ghost/","params":{"0":"/"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","accept-ranges":"bytes","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"d72-7438674ba0\"","content-type":"text/html; charset=UTF-8","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T08:17:20.085Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e6dd30a0-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/users/me/?include=roles","method":"GET","originalUrl":"/ghost/api/v2/admin/users/me/?include=roles","params":{"id":"me"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"include":"roles"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","content-length":"895","etag":"W/\"37f-qRvrbyiZVgMb0w/DlSr4d5jNboc\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"23ms"},"msg":"","time":"2019-04-03T08:17:20.579Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e6e10130-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/img/favicon.ico","method":"GET","originalUrl":"/ghost/assets/img/favicon.ico","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"3aee-7438674ba0\"","content-type":"image/x-icon","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T08:17:20.635Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e6ea9e20-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/site/","method":"GET","originalUrl":"/ghost/api/v2/admin/site/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","content-length":"75","etag":"W/\"4b-b+52MI9EmXxR8ps91ABHdlHWX68\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:17:20.646Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e6f3ecf0-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/config/","method":"GET","originalUrl":"/ghost/api/v2/admin/config/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","content-length":"197","etag":"W/\"c5-xgJ5VKKFeX6bysRsfdMXbg+Cj0U\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"7ms"},"msg":"","time":"2019-04-03T08:17:20.711Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e6f636e0-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/settings/?type=blog%2Ctheme%2Cprivate%2Cmembers","method":"GET","originalUrl":"/ghost/api/v2/admin/settings/?type=blog%2Ctheme%2Cprivate%2Cmembers","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"type":"blog,theme,private,members"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2c53-m4sAbvLBvzOtI141fuD7McKq18c\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"36ms"},"msg":"","time":"2019-04-03T08:17:20.757Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e6f74850-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/notifications/","method":"GET","originalUrl":"/ghost/api/v2/admin/notifications/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","content-length":"20","etag":"W/\"14-rGnko0plFblBZ6cCxL9htMA8NKo\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"34ms"},"msg":"","time":"2019-04-03T08:17:20.760Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e71111e0-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","method":"GET","originalUrl":"/ghost/api/v2/admin/posts/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"30","page":"1","filter":"status:[draft,scheduled,published]"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"17473-zo7u1CUc+MUaZeRpbCH7Zy75tq0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"177ms"},"msg":"","time":"2019-04-03T08:17:21.073Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e73e1550-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/tags/?limit=all","method":"GET","originalUrl":"/ghost/api/v2/admin/tags/?limit=all","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"64d-KAl/fxdCcdKg0HpNmtmh4e2ABhs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T08:17:21.232Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e73effb0-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/users/?limit=all&include=roles","method":"GET","originalUrl":"/ghost/api/v2/admin/users/?limit=all&include=roles","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all","include":"roles"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"6c1-q4AktiKg0D5/6827AwS0OB7HTyE\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T08:17:21.238Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"eae0b780-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","cache-control":"max-age=0","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/tag/spring-cloud-gateway/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"9904-LZpZp6R9BMEFIwPTEjzR9GNTz7g\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","etag":"W/\"9904-LZpZp6R9BMEFIwPTEjzR9GNTz7g\""},"statusCode":304,"responseTime":"105ms"},"msg":"","time":"2019-04-03T08:17:27.394Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"eb18de80-55e8-11e9-a41f-1dc48d552e2c","userId":null},"url":"/favicon.png","method":"GET","originalUrl":"/favicon.png","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","pragma":"no-cache","cache-control":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","content-type":"image/png","content-length":22234,"etag":"\"b588a0bc9e25c8ee42bc7deb77f9a0c9\"","cache-control":"public, max-age=86400"},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:17:27.659Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f5e4d8a0-55e8-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b19a-F3d+AtUQS4lUtzOBfjySadzRY7w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T08:17:45.816Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"40e9dd00-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b19a-F3d+AtUQS4lUtzOBfjySadzRY7w\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"64ms"},"msg":"","time":"2019-04-03T08:19:51.698Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"59d39450-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/?status=all","method":"GET","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/?status=all","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"status":"all"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"45bf-s5lmifFNQGeZ4jvYCNGwT5c9Kf0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"41ms"},"msg":"","time":"2019-04-03T08:20:33.471Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5a21b450-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/tags/?limit=all","method":"GET","originalUrl":"/ghost/api/v2/admin/tags/?limit=all","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"64d-KAl/fxdCcdKg0HpNmtmh4e2ABhs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T08:20:33.995Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5a236200-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/themes/","method":"GET","originalUrl":"/ghost/api/v2/admin/themes/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"64e-o3v9HhxylhSSNiPOQHGIamKf5AI\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T08:20:34.002Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5a229eb0-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/users/?limit=all&include=roles","method":"GET","originalUrl":"/ghost/api/v2/admin/users/?limit=all&include=roles","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all","include":"roles"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"6c1-U9t44ynAMt1AZ0NtXlouPh17ydY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T08:20:34.007Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"66c1f940-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"9904-LZpZp6R9BMEFIwPTEjzR9GNTz7g\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"68ms"},"msg":"","time":"2019-04-03T08:20:55.193Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"66dcad30-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/assets/built/screen.css?v=df61ece7fa","method":"GET","originalUrl":"/assets/built/screen.css?v=df61ece7fa","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"text/css,*/*;q=0.1","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{"v":"df61ece7fa"}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"9e68-7438674ba0\"","content-type":"text/css; charset=UTF-8","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"3ms"},"msg":"","time":"2019-04-03T08:20:55.304Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"66f676c0-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/assets/built/jquery.fitvids.js?v=df61ece7fa","method":"GET","originalUrl":"/assets/built/jquery.fitvids.js?v=df61ece7fa","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"*/*","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{"v":"df61ece7fa"}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"777-7438674ba0\"","content-type":"application/javascript; charset=UTF-8","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:20:55.471Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"67023690-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/03/F026AB14-863E-47DC-9E79-7E98B24EC37A.png","method":"GET","originalUrl":"/content/images/2019/03/F026AB14-863E-47DC-9E79-7E98B24EC37A.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Mon, 25 Mar 2019 11:01:21 GMT","etag":"W/\"1ccd-169b4830c20\"","content-type":"image/png","content-length":7373},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:20:55.548Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"67039620-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904309-54-01.png","method":"GET","originalUrl":"/content/images/2019/04/201904309-54-01.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 01:55:16 GMT","etag":"W/\"18553-169e0e856ca\"","content-type":"image/png","content-length":99667},"statusCode":200,"responseTime":"4ms"},"msg":"","time":"2019-04-03T08:20:55.559Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6703e440-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-47-50.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-47-50.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:48:00 GMT","etag":"W/\"9898-169e1189d1e\"","content-type":"image/png","content-length":39064},"statusCode":200,"responseTime":"4ms"},"msg":"","time":"2019-04-03T08:20:55.561Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6703e441-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/spring_cloud_gateway_diagram.png","method":"GET","originalUrl":"/content/images/2019/04/spring_cloud_gateway_diagram.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Mon, 01 Apr 2019 09:13:30 GMT","etag":"W/\"4138-169d82cd496\"","content-type":"image/png","content-length":16696},"statusCode":200,"responseTime":"6ms"},"msg":"","time":"2019-04-03T08:20:55.562Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6703bd30-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904310-18-12.png","method":"GET","originalUrl":"/content/images/2019/04/201904310-18-12.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 02:18:28 GMT","etag":"W/\"8401-169e0fd9497\"","content-type":"image/png","content-length":33793},"statusCode":200,"responseTime":"8ms"},"msg":"","time":"2019-04-03T08:20:55.564Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6705b900-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-24-39.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-24-39.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:24:49 GMT","etag":"W/\"83e5-169e13a53ac\"","content-type":"image/png","content-length":33765},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:20:55.571Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"670b3740-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904311-57-06.png","method":"GET","originalUrl":"/content/images/2019/04/201904311-57-06.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 03:57:21 GMT","etag":"W/\"b527-169e1581a91\"","content-type":"image/png","content-length":46375},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:20:55.606Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"670bac70-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904314-48-44.png","method":"GET","originalUrl":"/content/images/2019/04/201904314-48-44.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 06:53:54 GMT","etag":"W/\"10854-169e1f9bec6\"","content-type":"image/png","content-length":67668},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:20:55.612Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"670320f0-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/size/w2000/2019/04/201904219-27-11.png","method":"GET","originalUrl":"/content/images/size/w2000/2019/04/201904219-27-11.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Tue, 02 Apr 2019 11:30:48 GMT","etag":"W/\"eaa17-169ddd0e429\"","content-type":"image/png","content-length":961047},"statusCode":200,"responseTime":"100ms"},"msg":"","time":"2019-04-03T08:20:55.653Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"67983500-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-00-56.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-00-56.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:01:06 GMT","etag":"W/\"9c68-169e2005702\"","content-type":"image/png","content-length":40040},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:20:56.530Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"67d00de0-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/size/w30/2019/03/----_20190325174953.png","method":"GET","originalUrl":"/content/images/size/w30/2019/03/----_20190325174953.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Mon, 25 Mar 2019 11:06:30 GMT","etag":"W/\"2f2-169b487c568\"","content-type":"image/png","content-length":754},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T08:20:56.947Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"67d935a0-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-12-54.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-12-54.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:13:26 GMT","etag":"W/\"1bbef-169e20ba16e\"","content-type":"image/png","content-length":113647},"statusCode":200,"responseTime":"1ms"},"msg":"","time":"2019-04-03T08:20:56.958Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"67f6cfc0-55e9-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/04/201904315-29-14.png","method":"GET","originalUrl":"/content/images/2019/04/201904315-29-14.png","params":{},"headers":{"x-forwarded-for":"60.30.168.174","x-forwarded-proto":"https","x-real-ip":"60.30.168.174","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/spring-cloud-gatewayzhi-globalfilter/","accept-language":"zh-CN,zh;q=0.9","accept-encoding":"gzip, deflate"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Wed, 03 Apr 2019 07:29:39 GMT","etag":"W/\"33a8b-169e21a79de\"","content-type":"image/png","content-length":211595},"statusCode":200,"responseTime":"2ms"},"msg":"","time":"2019-04-03T08:20:57.151Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"681e7c00-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.208.198.158","x-forwarded-proto":"https","x-real-ip":"54.208.198.158","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b19a-1mh2Fj3xCLxymkM8k806KfMhWW4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T08:20:57.458Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6a845870-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"16257","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"],[\"a\",[\"href\",\"https://github.com/reactor/reactor-core\"]],[\"a\",[\"href\",\"https://github.com/IBlogLab/enhance-gateway\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[[0,[],0,\"整个filter的调用通过Ordered接口捆绑成一个链式结构，并且通过reactor流式编程将代码精简，这是一个非常优秀的思想，如果在自己的服务当中采用此编码模型的话，会使得代码清晰很多，感兴趣的读者可以参考学习\"],[0,[4],1,\"reactor-core\"],[0,[],0,\"。\"]]],[1,\"p\",[[0,[],0,\"本文主要分析了gateway的GlobalFilter的源码实现，对于enhance-gateway实现的GlobalFilter只是提及，这个是一种前后对应的设计思想，并不是很完美，计划在后续通过一篇独立的文章探讨自己的思想，并进行优化。\"]]],[1,\"p\",[[0,[],0,\"注：\"],[0,[5],1,\"enhance-gateway\"],[0,[],0,\"参考地址\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:09:58.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T08:20:33.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T08:20:33.000Z","facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","etag":"W/\"459e-jcEwP2NnNvFTLaClcOAP/qH3Vu8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"266ms"},"msg":"","time":"2019-04-03T08:21:01.701Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"ae4af640-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"52.54.76.134","x-forwarded-proto":"https","x-real-ip":"52.54.76.134","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b14d-k1xYB4YiDwxqUIMysLy0k0TJza4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T08:22:55.192Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"de23a650-55e9-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b14d-k1xYB4YiDwxqUIMysLy0k0TJza4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"76ms"},"msg":"","time":"2019-04-03T08:24:15.491Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0b3c24f0-55ea-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b14d-k1xYB4YiDwxqUIMysLy0k0TJza4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"58ms"},"msg":"","time":"2019-04-03T08:25:31.131Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5269bb80-55ea-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/5ca346c572737b08a9e9f1e3/","method":"PUT","originalUrl":"/ghost/api/v2/admin/posts/5ca346c572737b08a9e9f1e3/","params":{"id":"5ca346c572737b08a9e9f1e3"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"16257","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"posts":{"0":{"id":"5ca346c572737b08a9e9f1e3","created_at":"2019-04-02T11:25:57.000Z","excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","custom_excerpt":"讲解关于spring-cloud-gateway全局过滤器的设计与实现，剖析代码原理。","featured":false,"feature_image":"https://lancexlab.cn/content/images/2019/04/201904219-27-11.png","canonical_url":null,"codeinjection_foot":null,"codeinjection_head":null,"custom_template":null,"og_image":null,"og_title":null,"og_description":null,"twitter_image":null,"twitter_title":null,"twitter_description":null,"html":null,"locale":null,"meta_description":null,"meta_title":null,"mobiledoc":"{\"version\":\"0.3.1\",\"atoms\":[],\"cards\":[[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904309-54-01.png\",\"caption\":\"GlobalFilters\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904310-18-12.png\"}],[\"image\",{\"src\":\"/content/images/2019/04/201904310-47-50.png\"}],[\"markdown\",{\"markdown\":\"* org.iblog.enhance.gateway.filter.MarkRequestFilter@75c589f2: -2147483647,\\n* org.springframework.cloud.gateway.filter.AdaptCachedBodyGlobalFilter@7c8f803d: -2147482648,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRequestBodyFilter@6db04a6: -1000,\\n* org.iblog.enhance.gateway.filter.convert.ConvertRequestBodyFilter@1bba9862: -900,\\n* org.iblog.enhance.gateway.filter.extract.ExtractRequestBodyFilter@565c887e: -800,\\n* org.iblog.enhance.gateway.filter.async.AsyncProcessingFilter@1317ac2c: -700,\\n* org.iblog.enhance.gateway.filter.convert.ConvertResponseBodyFilter@451a4187: -25,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseBodyFilter@8f374de: -20,\\n* org.iblog.enhance.gateway.filter.extract.ExtractResponseBodyFilter@5c215642: -10,\\n* org.springframework.cloud.gateway.filter.NettyWriteResponseFilter@4e26c308: -1,\\n* org.springframework.cloud.gateway.filter.ForwardPathFilter@7c6ab057: 0,\\n* org.springframework.cloud.gateway.filter.GatewayMetricsFilter@1f7557fe: 0,\\n* org.iblog.enhance.gateway.filter.logging.LoggingResponseStatusFilter@426913c4: 1,\\n* org.springframework.cloud.gateway.filter.RouteToRequestUrlFilter@176e839e: 10000,\\n* org.springframework.cloud.gateway.filter.LoadBalancerClientFilter@363ba634: 10100,\\n* org.iblog.enhance.gateway.filter.logging.LoggingRealPathFilter@416c1b0: 10101\\n* org.springframework.cloud.gateway.filter.WebsocketRoutingFilter@7ce4498f: 2147483646,\\n* org.springframework.cloud.gateway.filter.ForwardRoutingFilter@4ac0d49: 2147483647,\"}],[\"html\",{\"html\":\"<img src=\\\"/content/images/2019/04/spring_cloud_gateway_diagram.png\\\" />\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904311-24-39.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904311-57-06.png\"}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904314-48-44.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-00-56.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-12-54.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-29-14.png\",\"cardWidth\":\"\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-41-52.png\"}],[\"hr\",{}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-52-49.png\"}],[\"hr\",{}],[\"image\",{\"src\":\"/content/images/2019/04/201904315-58-19.png\"}],[\"hr\",{}]],\"markups\":[[\"strong\"],[\"a\",[\"href\",\"https://github.com/dropwizard/metrics\"]],[\"a\",[\"href\",\"https://github.com/dropwizard/dropwizard\"]],[\"em\"],[\"a\",[\"href\",\"https://github.com/reactor/reactor-core\"]],[\"a\",[\"href\",\"https://github.com/IBlogLab/enhance-gateway\"]]],\"sections\":[[10,0],[1,\"blockquote\",[[0,[],0,\"引言\"]]],[1,\"p\",[[0,[],0,\"全局过滤器无疑是作用于所有经过网关转发的请求的，对于设计者来说被设计成全局过滤器实现的功能组件也即是设计者认为此功能是网关所必备的功能组件，这点非常重要的，对于引入spring-cloud-gateway做二次封装的时候，我们应该秉承作者的设计思想，即如果需要增加一个全局过滤组件的时候应该实现一个全局过滤器（即实现GlobalFilter接口）。\"]]],[1,\"p\",[[0,[],0,\"我们可以通过gateway内嵌的endpoint来查看GlobalFilter列表（/actuator/gateway/globalfilters）：\"]]],[10,1],[1,\"p\",[[0,[],0,\"从api结果可以看到一个全局过滤器列表，并且没一个过滤器都有一个排序id，gateway是通过同时实现Ordered接口来实现控制过滤器的过滤顺序的，其中id越小其代表的优先级越高。\"]]],[10,2],[1,\"blockquote\",[[0,[],0,\"预览GlobalFilter、Ordered\"]]],[10,3],[1,\"p\",[[0,[],0,\"从GlobalFilter接口的声明来看，其作用及其明确，就是定义了一个filter行为，用于拦截web请求和实现一些跨领域，与应用无关的需求，比如安全验证、超时判断和其他的一些功能性行为。\"]]],[10,4],[1,\"p\",[[0,[],0,\"Ordered接口是spring框架的一个规范接口，用于元素排序或者需要有序的对象实现该接口。\"]]],[1,\"p\",[[0,[],0,\"从endpoint api的结果中我们将\"],[0,[0],1,\"org.springframework.cloud.gateway.filter.*\"],[0,[],0,\"包下的全局过滤器罗列出来，\"],[0,[0],1,\"org.iblog.enhance.gateway.filter.*\"],[0,[],0,\"包下的均是增强实现的拦截功能（本文对于自增实现只简单提及，后续章节会详细解释）。\"]]],[10,5],[1,\"p\",[[0,[],0,\"展示官方的架构设计图，所有的filtter则按照图中filter模块进行工作，处于handler-proxied模块之间，而且是一个双向的工作关系：\"]]],[10,6],[10,7],[1,\"blockquote\",[[0,[],0,\"MarkRequestFilter　|　优先级：-2147483647\"]]],[1,\"p\",[[0,[],0,\"这是我个人实现的一个GlobalFilter，这是为自己在后续功能实现而准备的一个过滤器；为每一个request第一时间分配一个uniqueue_key，并且set到exchange的attributes属性列表当中。\"]]],[10,8],[10,9],[1,\"blockquote\",[[0,[],0,\"AdaptCachedBodyGlobalFilter　|　优先级：-2147482648\"]]],[1,\"p\",[[0,[],0,\"gateway内置的一个GlobalFilter，其作用是从exchange的attributes中或者cachedRequestBody属性值作为request的body，注意使用此功能首先必须预设cachedRequestBody属性至attributes中，这个必须要手动设置，无法通过配置来设置的，可以在优先级更高的filter中来设置cachedRequestBody；当然也可以自己写一个FilterFactory类来做成配置化；我个人觉得暂时这个过滤器作用场景还不太明确，可以不用太考虑。\"]]],[10,10],[10,11],[1,\"blockquote\",[[0,[],0,\"LoggingRequestBodyFilter　|  优先级： -1000\"]]],[1,\"p\",[[0,[],0,\"这个GlobalFilter是我自己实现的，其功能是对于gateway透传的每一个请求进行日志跟踪并且记录至持久化层，这里会将request的基础信息logging下来，初始化一个日志实体存储。\"]]],[10,12],[1,\"blockquote\",[[0,[],0,\"ConvertRequestBodyFilter　|　优先级： -900\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能在还是比较常见的，尤其是面向B端客户需求的时候，会有接口对接时报文转换的需求，在这个filter中就是实现了这种应用无感知的转换。\"]]],[10,13],[1,\"blockquote\",[[0,[],0,\"ExtractRequestBodyFilter　|　优先级：-800\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这个功能与ConvertRequestBodyFilter类似，只不过这里不是报文转换，而是实现从报文中抽取一些关键词，这个filter从某个角度上其实可以考虑与ConvertRequestBodyFilter合并成一个filter实现，这个取决于需求的复杂性。\"]]],[10,14],[1,\"blockquote\",[[0,[],0,\"AsyncProcessingFilter　|　优先级：-700\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，这里是一种针对性的需求，接受调用方一个请求，而调用方对于处理结果的处理进度没有时间敏感或者任务处理时常过长的情况，采用即时反馈而异步作处理的方式来处理。\"]]],[10,15],[1,\"blockquote\",[[0,[],0,\"ConvertResponseBodyFilter　|　优先级：-25\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与ConvertRequestBodyFilter对称，对于response的body做输出报文转换的需求，这个视具体应用场景来定，算是一种比较常见的开发场景。\"]]],[10,16],[1,\"blockquote\",[[0,[],0,\"LoggingResponseBodyFilter　|　优先级：-20\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，与LoggingRequestBodyFilter对称，将response的body记录进日志需求中。\"]]],[10,17],[1,\"blockquote\",[[0,[],0,\"ExtractResponseBodyFilter　|　优先级：-10\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与ExtractRequestBodyFilter对称，将response的body中的关键词记录进日志需求中。\"]]],[10,18],[1,\"blockquote\",[[0,[],0,\"NettyWriteResponseFilter　|　优先级：-1\"]]],[1,\"p\",[[0,[],0,\"将Netty代理调用的response数据流写入ServerHttpResponse的body中，此外这个是一个先调用后发生的行为动作，流式编程的典型范例，也是验证了之前所说的filter的链式调用是一个对称的模型，对于优先级越高的行为定义其真实发生其实越晚，NettyWriteResponseFilter将结果数据流写入ServerHttpResponse中发生在NettyRouting获取到远程调用的结果数据流之后，当NettyRouting拿到结果数据流之后会将其写入当前请求exchange的attributes中，写入发生在return语句。建议调试阶段可以将log level设置为trace，这样可以清楚地观察请求的行为发生轨迹。\"]]],[10,19],[10,20],[1,\"blockquote\",[[0,[],0,\"ForwardPathFilter　|　优先级：0\"]]],[1,\"p\",[[0,[],0,\"这是一个条件过滤器，只有当请求的header scheme为forward的时候才会发生，否则会忽略没有任何作用，当有转发需求的时候会将request的请求path修改，从而修改了请求的目的地址。\"]]],[10,21],[10,22],[1,\"blockquote\",[[0,[],0,\"GatewayMetricsFilter　|　优先级：０\"]]],[1,\"p\",[[0,[],0,\"metrics实现，对于每个请求记录其发生时间戳，包括开始和结束时间以及请求状态，gateway集成了micrometer框架来实现的，个人觉得这个metrics实现并不是非常完美，micrometer实现其实依赖了\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"，\"],[0,[1],1,\"dropwizard-metrics\"],[0,[],0,\"与微服务框架\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"之间可以无缝集成，效果非常好，监控数据是非常全面的，而micrometer实现比较精简，感兴趣的读者可以学习一下\"],[0,[2],1,\"dropwizard\"],[0,[],0,\"的使用，轻量级容易上手开发。\"]]],[10,23],[10,24],[1,\"blockquote\",[[0,[],0,\"LoggingResponseStatusFilter　|　优先级：１\"]]],[1,\"p\",[[0,[],0,\"　属于enhance-gateway自己的实现，与GatewayMetricsFilter记录请求结果状态一致，不过我是基于依赖做的二次开发，无法复用已有的逻辑部分；这里有个需要注意的地方，就是其优先级必须发生在NettyWriteResponseFilter之后，也就是要大于-1才能获取到status，否则取到的会是null。\"]]],[10,25],[1,\"blockquote\",[[0,[],0,\"RouteToRequestUrlFilter　|　优先级：10000\"]]],[1,\"p\",[[0,[],0,\"RouteToRequestUrlFilter是必须的全局过滤器，这个会在你通过注册中心配置一个下游服务的时候起作用，请求进来的时候path的前缀是gateway的服务地址（ip+port或者是域名），但是对于真实的请求调用，必须将其uri映射至服务id上；比如将path的192.168.20.134:10080映射至服务lb://{serviceId}；而对于绝对路径配置的服务exchange的\"],[0,[3],1,\"GATEWAY_ROUTE_ATTR属性将会是null，直接过滤到下一个过滤器，而不会发生path的真实映射。\"]]],[10,26],[10,27],[1,\"blockquote\",[[0,[],0,\"LoadBalancerClientFilter　|　优先级：10100\"]]],[1,\"p\",[[0,[],0,\"LoadBalancerClientFilter负责服务真实ip的映射，主要针对对个服务节点的情况进行负载均衡，默认采用的netflix-ribbon作为负载均衡器，首先如果scheme不是服务节点映射的话直接过滤，获取服务节点，69行的choose函数是真实负载均衡发生的函数，获取一个本次选出的服务server instance（如果是单节点则无负载计算），然后将服务的真实ip+port替换掉path中的lb://{serviceId}前缀。\"]]],[10,28],[10,29],[1,\"blockquote\",[[0,[],0,\"LoggingRealPathFilter　|　优先级：10101\"]]],[1,\"p\",[[0,[],0,\"属于enhance-gateway自己的实现，发生在LoadBalancerClientFilter之后便可以获取当前请求的真实path。\"]]],[10,30],[1,\"blockquote\",[[0,[],0,\"WebsocketRoutingFilter　|　优先级：2147483646\"]]],[1,\"p\",[[0,[],0,\"WebsocketRoutingFilter过滤器实现了gateway对于websocket的支持，内部通过websocketClient实现将一个http请求协议换转成websocket，实现调用方无感知的请求websocket的服务，只需要将schme设置成ws或者wss这么简单。\"]]],[10,31],[10,32],[1,\"blockquote\",[[0,[],0,\"ForwardRoutingFilter　|　优先级：2147483647\"]]],[1,\"p\",[[0,[],0,\"ForwardRoutingFilter是一个结束操作，经过filter chain的链式调用，最终将exchange交还给web handler做http请求处理。\"]]],[10,33],[10,34],[1,\"blockquote\",[[0,[],0,\"总结\"]]],[1,\"p\",[[0,[],0,\"源码当中还有两个GlobalFilter，分别是WebClientHttpRoutingFilter、WebClientWriteResponseFilter，/actuator/gateway/globalfilters结果当中不包含它们原因是没有在GatewayAutoConfiguration依赖注入，作者还没启用。\"]]],[1,\"p\",[[0,[],0,\"整个filter的调用通过Ordered接口捆绑成一个链式结构，并且通过reactor流式编程将代码精简，这是一个非常优秀的思想，如果在自己的服务当中采用此编码模型的话，会使得代码清晰很多，感兴趣的读者可以参考学习\"],[0,[4],1,\"reactor-core\"],[0,[],0,\"。\"]]],[1,\"p\",[[0,[],0,\"本文主要分析了gateway的GlobalFilter的源码实现，对于enhance-gateway实现的GlobalFilter只是提及，这个是一种前后对应的设计思想，并不是很完美，计划在后续通过一篇独立的文章探讨自己的思想，并进行优化。\"]]],[1,\"p\",[[0,[],0,\"注：\"],[0,[5],1,\"enhance-gateway\"],[0,[],0,\"参考地址\"]]]]}","plaintext":null,"published_at":"2019-04-02T11:30:34.000Z","slug":"spring-cloud-gatewayzhi-globalfilter","status":"published","title":"spring-cloud-gateway之GlobalFilter","updated_at":"2019-04-03T08:21:01.000Z","authors":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T08:20:33.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T08:20:33.000Z","facebook":null,"twitter":null,"tour":"[\"getting-started\",\"featured-post\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}},"published_by":null,"tags":{"0":{"id":"5c9c904072737b08a9e9f072","name":"spring-cloud-gateway","slug":"spring-cloud-gateway","description":"A little research and sharing on the open source project spring-cloud-gateway.","parent":null,"meta_title":null,"meta_description":null,"feature_image":"https://lancexlab.cn/content/images/2019/03/menu.saveimg.savepath20190328171657.jpg","visibility":"public","created_at":"2019-03-28T09:13:36.000Z","updated_at":"2019-03-28T09:20:20.000Z"}}}}},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","content-type":"application/json; charset=utf-8","etag":"W/\"459e-jcEwP2NnNvFTLaClcOAP/qH3Vu8\"","content-encoding":"gzip"},"statusCode":200,"responseTime":"113ms"},"msg":"","time":"2019-04-03T08:27:30.606Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"55cc9590-55ea-11e9-a41f-1dc48d552e2c","userId":null},"url":"/spring-cloud-gatewayzhi-globalfilter/","method":"GET","originalUrl":"/spring-cloud-gatewayzhi-globalfilter/","params":{"slug":"spring-cloud-gatewayzhi-globalfilter"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","if-none-match":"W/\"9904-LZpZp6R9BMEFIwPTEjzR9GNTz7g\""},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"public, max-age=0","content-type":"text/html; charset=utf-8","etag":"W/\"98f9-F8t7Fy456E5JXwaRLjLhUzaOCt4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"192ms"},"msg":"","time":"2019-04-03T08:27:36.363Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"6633cd90-55ea-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b14d-k1xYB4YiDwxqUIMysLy0k0TJza4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"63ms"},"msg":"","time":"2019-04-03T08:28:03.754Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"91e5b750-55ea-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b14d-k1xYB4YiDwxqUIMysLy0k0TJza4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T08:29:17.052Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a9379090-55ea-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b14d-k1xYB4YiDwxqUIMysLy0k0TJza4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T08:29:56.177Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0990c970-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","method":"GET","originalUrl":"/ghost/api/v2/admin/posts/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"30","page":"1","filter":"status:[draft,scheduled,published]"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"17452-V+XaLpJo5U8smn053sSmGSgf2gY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"54ms"},"msg":"","time":"2019-04-03T08:32:37.823Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0accf2f0-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/subscribers/?limit=30&order=created_at%20desc&page=1","method":"GET","originalUrl":"/ghost/api/v2/admin/subscribers/?limit=30&order=created_at%20desc&page=1","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"30","order":"created_at desc","page":"1"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","content-length":"994","etag":"W/\"3e2-L5Vd1ap0rEYIPJqtWefYY1THXMM\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"24ms"},"msg":"","time":"2019-04-03T08:32:39.864Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0db741a0-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/invites/?limit=all","method":"GET","originalUrl":"/ghost/api/v2/admin/invites/?limit=all","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","content-length":"555","etag":"W/\"22b-VuEqkx43N/2Wp/7LOJbsKl8BGak\"","vary":"Accept-Encoding"},"statusCode":200,"responseTime":"31ms"},"msg":"","time":"2019-04-03T08:32:44.762Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"0db65740-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/users/?limit=all&include=roles","method":"GET","originalUrl":"/ghost/api/v2/admin/users/?limit=all&include=roles","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all","include":"roles"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"6c1-U9t44ynAMt1AZ0NtXlouPh17ydY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"39ms"},"msg":"","time":"2019-04-03T08:32:44.764Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"12ddc4b0-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/pages/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","method":"GET","originalUrl":"/ghost/api/v2/admin/pages/?limit=30&page=1&filter=status%3A%5Bdraft%2Cscheduled%2Cpublished%5D","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"30","page":"1","filter":"status:[draft,scheduled,published]"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"1085-oS47A4Tm0PGHfHVbArD5ZD2+iis\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"28ms"},"msg":"","time":"2019-04-03T08:32:53.400Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"12ed06f0-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/tags/?limit=all","method":"GET","originalUrl":"/ghost/api/v2/admin/tags/?limit=all","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"64d-KAl/fxdCcdKg0HpNmtmh4e2ABhs\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T08:32:53.517Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"12edf150-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/users/?limit=all&include=roles","method":"GET","originalUrl":"/ghost/api/v2/admin/users/?limit=all&include=roles","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"limit":"all","include":"roles"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"6c1-U9t44ynAMt1AZ0NtXlouPh17ydY\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"48ms"},"msg":"","time":"2019-04-03T08:32:53.527Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"169c2c40-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/settings/?type=blog%2Ctheme%2Cprivate%2Cmembers","method":"GET","originalUrl":"/ghost/api/v2/admin/settings/?type=blog%2Ctheme%2Cprivate%2Cmembers","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"type":"blog,theme,private,members"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2c53-m4sAbvLBvzOtI141fuD7McKq18c\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"28ms"},"msg":"","time":"2019-04-03T08:32:59.682Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"16aec9e0-55eb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/2019/03/56601E4F-A6F3-4670-A146-3EA171255A30.jpeg","method":"GET","originalUrl":"/content/images/2019/03/56601E4F-A6F3-4670-A146-3EA171255A30.jpeg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Mon, 25 Mar 2019 11:01:37 GMT","etag":"W/\"2d430-169b4834cec\"","content-type":"image/jpeg","content-length":185392},"statusCode":200,"responseTime":"43ms"},"msg":"","time":"2019-04-03T08:32:59.819Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"19276b00-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/settings/?type=blog%2Ctheme%2Cprivate%2Cmembers","method":"GET","originalUrl":"/ghost/api/v2/admin/settings/?type=blog%2Ctheme%2Cprivate%2Cmembers","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{"type":"blog,theme,private,members"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2c53-m4sAbvLBvzOtI141fuD7McKq18c\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"27ms"},"msg":"","time":"2019-04-03T08:33:03.948Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"19287c70-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/themes/","method":"GET","originalUrl":"/ghost/api/v2/admin/themes/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"64e-o3v9HhxylhSSNiPOQHGIamKf5AI\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"26ms"},"msg":"","time":"2019-04-03T08:33:03.954Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"194d4282-55eb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/img/themes/valkyrie-3ce1c51ff5a8fb77494a97ee192f199a.jpg","method":"GET","originalUrl":"/ghost/assets/img/themes/valkyrie-3ce1c51ff5a8fb77494a97ee192f199a.jpg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"bb4a-7438674ba0\"","content-type":"image/jpeg","content-length":47946},"statusCode":200,"responseTime":"37ms"},"msg":"","time":"2019-04-03T08:33:04.206Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"194d1b70-55eb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/img/themes/massively-06edf00108429f7fb8e65f190fba34fe.jpg","method":"GET","originalUrl":"/ghost/assets/img/themes/massively-06edf00108429f7fb8e65f190fba34fe.jpg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"8676-7438674ba0\"","content-type":"image/jpeg","content-length":34422},"statusCode":200,"responseTime":"40ms"},"msg":"","time":"2019-04-03T08:33:04.210Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"194d4283-55eb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/img/themes/sente-3c2bd8202c626b11048c3bc6bddc250a.jpg","method":"GET","originalUrl":"/ghost/assets/img/themes/sente-3c2bd8202c626b11048c3bc6bddc250a.jpg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"7f14-7438674ba0\"","content-type":"image/jpeg","content-length":32532},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T08:33:04.211Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"194d4281-55eb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/img/themes/farafra-800f5fbb100aaefbefe42e8f79fa3391.jpg","method":"GET","originalUrl":"/ghost/assets/img/themes/farafra-800f5fbb100aaefbefe42e8f79fa3391.jpg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"1768b-7438674ba0\"","content-type":"image/jpeg","content-length":95883},"statusCode":200,"responseTime":"45ms"},"msg":"","time":"2019-04-03T08:33:04.214Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"194d1b71-55eb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/img/themes/nurui-146ba228f415aa6dc073911c5eedd524.jpg","method":"GET","originalUrl":"/ghost/assets/img/themes/nurui-146ba228f415aa6dc073911c5eedd524.jpg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"12993-7438674ba0\"","content-type":"image/jpeg","content-length":76179},"statusCode":200,"responseTime":"49ms"},"msg":"","time":"2019-04-03T08:33:04.217Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"194d4280-55eb-11e9-a41f-1dc48d552e2c","userId":null},"url":"/img/themes/pacific-182fa717198992c893b4afd7b1dd1096.jpg","method":"GET","originalUrl":"/ghost/assets/img/themes/pacific-182fa717198992c893b4afd7b1dd1096.jpg","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","accept":"image/webp,image/apng,image/*,*/*;q=0.8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","accept-ranges":"bytes","cache-control":"public, max-age=31536000","last-modified":"Sat, 26 Oct 1985 08:15:00 GMT","etag":"W/\"1d564-7438674ba0\"","content-type":"image/jpeg","content-length":120164},"statusCode":200,"responseTime":"66ms"},"msg":"","time":"2019-04-03T08:33:04.235Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"1ae96650-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.66.188","x-forwarded-proto":"https","x-real-ip":"54.196.66.188","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b14d-k1xYB4YiDwxqUIMysLy0k0TJza4\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"53ms"},"msg":"","time":"2019-04-03T08:33:06.923Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2508a5b0-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/users/1/?include=roles","method":"PUT","originalUrl":"/ghost/api/v2/admin/users/1/?include=roles","params":{"id":"1"},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","content-length":"906","origin":"https://lancexlab.cn","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{"users":{"0":{"id":"1","name":"lance xu","slug":"lance","email":"13554225105@163.com","profile_image":"https://lancexlab.cn/content/images/2019/03/D38D5162-C79C-4439-AB54-8B3B04129CA1.jpeg","cover_image":"https://lancexlab.cn/content/images/2019/03/4108A4F6-6264-48B0-B0BC-56A3BF582E38.jpeg","bio":"By lance, love coding.  ","website":"https://lancexlab.cn/author/lance/","location":null,"accessibility":"{\"nightShift\":true}","status":"active","locale":null,"meta_title":null,"meta_description":null,"last_seen":"2019-04-03T08:20:33.000Z","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-04-03T08:20:33.000Z","facebook":null,"twitter":null,"tour":"[\"getting-started\",\"using-the-editor\",\"featured-post\",\"upload-a-theme\"]","roles":{"0":{"id":"5c989f0d9819ed1e4cb98a8d","name":"Owner","description":"Blog Owner","created_at":"2019-03-25T09:27:41.000Z","updated_at":"2019-03-25T09:27:41.000Z"}}}}},"query":{"include":"roles"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","access-control-allow-origin":"https://lancexlab.cn","vary":"Origin, Accept-Encoding","x-cache-invalidate":"/*","content-type":"application/json; charset=utf-8","content-length":"935","etag":"W/\"3a7-RD018+TAArfhHe+jB7xUlU0d/UE\""},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T08:33:23.914Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"25f50180-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/themes/","method":"GET","originalUrl":"/ghost/api/v2/admin/themes/","params":{},"headers":{"x-forwarded-for":"101.86.166.204","x-forwarded-proto":"https","x-real-ip":"101.86.166.204","host":"lancexlab.cn","connection":"close","accept":"application/json, text/javascript, */*; q=0.01","x-requested-with":"XMLHttpRequest","x-ghost-version":"2.18","app-pragma":"no-cache","user-agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36","content-type":"application/json; charset=UTF-8","referer":"https://lancexlab.cn/ghost/","accept-encoding":"gzip, deflate, br","accept-language":"zh-CN,zh;q=0.9,en;q=0.8"},"body":{},"query":{}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"64e-o3v9HhxylhSSNiPOQHGIamKf5AI\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"13ms"},"msg":"","time":"2019-04-03T08:33:25.415Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"42c568e0-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"52ms"},"msg":"","time":"2019-04-03T08:34:13.796Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"52fd0560-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.235.39","x-forwarded-proto":"https","x-real-ip":"18.234.235.39","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T08:34:41.011Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"db1a7310-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T08:38:29.370Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"dcaf1cd0-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"61ms"},"msg":"","time":"2019-04-03T08:38:32.028Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"f9a8b710-55eb-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T08:39:20.628Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"76352cf0-55ec-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"42ms"},"msg":"","time":"2019-04-03T08:42:49.578Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"a6ae3bb0-55ec-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.203.242.124","x-forwarded-proto":"https","x-real-ip":"34.203.242.124","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"140ms"},"msg":"","time":"2019-04-03T08:44:11.001Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"acfee6e0-55ec-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.203.242.124","x-forwarded-proto":"https","x-real-ip":"34.203.242.124","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"78ms"},"msg":"","time":"2019-04-03T08:44:21.534Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"3289c2d0-55ed-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"52.54.76.134","x-forwarded-proto":"https","x-real-ip":"52.54.76.134","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"65ms"},"msg":"","time":"2019-04-03T08:48:05.569Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"4d34d930-55ed-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"47ms"},"msg":"","time":"2019-04-03T08:48:50.291Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"5e5a3110-55ed-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T08:49:19.066Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e15ba300-55ed-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.235.39","x-forwarded-proto":"https","x-real-ip":"18.234.235.39","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"55ms"},"msg":"","time":"2019-04-03T08:52:58.856Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e8f262c0-55ed-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.235.39","x-forwarded-proto":"https","x-real-ip":"18.234.235.39","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"74ms"},"msg":"","time":"2019-04-03T08:53:11.607Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"216b7a60-55ee-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.235.39","x-forwarded-proto":"https","x-real-ip":"18.234.235.39","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"51ms"},"msg":"","time":"2019-04-03T08:54:46.331Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"893a7d80-55ee-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"59ms"},"msg":"","time":"2019-04-03T08:57:40.501Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"9f1e20c0-55ee-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.196.66.188","x-forwarded-proto":"https","x-real-ip":"54.196.66.188","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"60ms"},"msg":"","time":"2019-04-03T08:58:17.225Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"e1924df0-55ee-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"3.81.172.187","x-forwarded-proto":"https","x-real-ip":"3.81.172.187","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"60ms"},"msg":"","time":"2019-04-03T09:00:08.718Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2dcbb3a0-55ef-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.235.39","x-forwarded-proto":"https","x-real-ip":"18.234.235.39","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"50ms"},"msg":"","time":"2019-04-03T09:02:16.588Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"57791ad0-55ef-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"18.234.235.39","x-forwarded-proto":"https","x-real-ip":"18.234.235.39","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"57ms"},"msg":"","time":"2019-04-03T09:03:26.519Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"882dd300-55ef-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"173ms"},"msg":"","time":"2019-04-03T09:04:48.350Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"d36977c0-55ef-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"54.242.179.31","x-forwarded-proto":"https","x-real-ip":"54.242.179.31","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"71ms"},"msg":"","time":"2019-04-03T09:06:54.469Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2243c710-55f0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.203.242.124","x-forwarded-proto":"https","x-real-ip":"34.203.242.124","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"46ms"},"msg":"","time":"2019-04-03T09:09:06.736Z","v":0}
{"name":"Log","hostname":"VM-0-4-ubuntu","pid":2217,"level":30,"req":{"meta":{"requestId":"2e542810-55f0-11e9-a41f-1dc48d552e2c","userId":"1"},"url":"/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","method":"GET","originalUrl":"/ghost/api/v0.1/posts/?include=author%2Ctags&formats=mobiledoc%2Chtml%2Cplaintext&order=updated_at%20desc&status=published","params":{},"headers":{"x-forwarded-for":"34.203.242.124","x-forwarded-proto":"https","x-real-ip":"34.203.242.124","host":"lancexlab.cn","connection":"close","user-agent":"Zapier","content-type":"application/json; charset=utf-8","accept-encoding":"gzip,deflate","accept":"*/*"},"body":{},"query":{"include":"author,tags","formats":"mobiledoc,html,plaintext","order":"updated_at desc","status":"published"}},"res":{"_headers":{"x-powered-by":"Express","cache-control":"no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0","content-type":"application/json; charset=utf-8","etag":"W/\"2b1c5-YR8T5bbSykO+D8MRCs5H3wmGyh0\"","vary":"Accept-Encoding","content-encoding":"gzip"},"statusCode":200,"responseTime":"77ms"},"msg":"","time":"2019-04-03T09:09:27.007Z","v":0}
